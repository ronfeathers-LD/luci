{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/ron.feathers/GitHub/LUCI/src/lib/supabase-server.js"],"sourcesContent":["/**\n * Server-side Supabase Client for Next.js\n * Uses the same logic as lib/supabase-client.js but as ES module\n */\n\nexport function getSupabaseClient() {\n  try {\n    const { createClient } = require('@supabase/supabase-js');\n    const supabaseUrl = process.env.SUPABASE_URL;\n    const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n    \n    if (!supabaseUrl || !supabaseServiceKey) {\n      const missing = [];\n      if (!supabaseUrl) missing.push('SUPABASE_URL');\n      if (!supabaseServiceKey) missing.push('SUPABASE_SERVICE_ROLE_KEY');\n      console.error(`[Supabase] Missing environment variables: ${missing.join(', ')}`);\n      return null;\n    }\n    \n    return createClient(supabaseUrl, supabaseServiceKey, {\n      auth: {\n        autoRefreshToken: false,\n        persistSession: false\n      }\n    });\n  } catch (error) {\n    console.error('[Supabase] Error creating client:', error.message);\n    if (error.stack) {\n      console.error('[Supabase] Stack:', error.stack);\n    }\n    return null;\n  }\n}\n\nexport function validateSupabase(supabase) {\n  if (!supabase) {\n    return {\n      valid: false,\n      error: { status: 503, message: 'Database not configured' }\n    };\n  }\n  return { valid: true };\n}\n\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;;;AAEM,SAAS;IACd,IAAI;QACF,MAAM,EAAE,YAAY,EAAE;QACtB,MAAM,cAAc,QAAQ,GAAG,CAAC,YAAY;QAC5C,MAAM,qBAAqB,QAAQ,GAAG,CAAC,yBAAyB;QAEhE,IAAI,CAAC,eAAe,CAAC,oBAAoB;YACvC,MAAM,UAAU,EAAE;YAClB,IAAI,CAAC,aAAa,QAAQ,IAAI,CAAC;YAC/B,IAAI,CAAC,oBAAoB,QAAQ,IAAI,CAAC;YACtC,QAAQ,KAAK,CAAC,CAAC,0CAA0C,EAAE,QAAQ,IAAI,CAAC,OAAO;YAC/E,OAAO;QACT;QAEA,OAAO,aAAa,aAAa,oBAAoB;YACnD,MAAM;gBACJ,kBAAkB;gBAClB,gBAAgB;YAClB;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,qCAAqC,MAAM,OAAO;QAChE,IAAI,MAAM,KAAK,EAAE;YACf,QAAQ,KAAK,CAAC,qBAAqB,MAAM,KAAK;QAChD;QACA,OAAO;IACT;AACF;AAEO,SAAS,iBAAiB,QAAQ;IACvC,IAAI,CAAC,UAAU;QACb,OAAO;YACL,OAAO;YACP,OAAO;gBAAE,QAAQ;gBAAK,SAAS;YAA0B;QAC3D;IACF;IACA,OAAO;QAAE,OAAO;IAAK;AACvB"}},
    {"offset": {"line": 99, "column": 0}, "map": {"version":3,"sources":["file:///Users/ron.feathers/GitHub/LUCI/src/app/api/health/route.js"],"sourcesContent":["/**\n * Health Check API Route\n * Simple endpoint to test database connectivity\n */\n\nimport { NextResponse } from 'next/server';\nimport { getSupabaseClient } from '../../../lib/supabase-server';\n\nexport async function GET() {\n  try {\n    // Check environment variables\n    const hasUrl = !!process.env.SUPABASE_URL;\n    const hasKey = !!process.env.SUPABASE_SERVICE_ROLE_KEY;\n    \n    const envStatus = {\n      SUPABASE_URL: hasUrl ? '✅ Set' : '❌ Missing',\n      SUPABASE_SERVICE_ROLE_KEY: hasKey ? '✅ Set' : '❌ Missing',\n    };\n    \n    if (!hasUrl || !hasKey) {\n      return NextResponse.json({\n        status: 'error',\n        message: 'Environment variables not configured',\n        environment: envStatus,\n        timestamp: new Date().toISOString(),\n      }, { status: 503 });\n    }\n    \n    // Try to create Supabase client\n    const supabase = getSupabaseClient();\n    \n    if (!supabase) {\n      return NextResponse.json({\n        status: 'error',\n        message: 'Failed to create Supabase client',\n        environment: envStatus,\n        timestamp: new Date().toISOString(),\n      }, { status: 503 });\n    }\n    \n    // Try a simple query to test connection\n    const { data, error } = await supabase\n      .from('users')\n      .select('count')\n      .limit(1);\n    \n    if (error) {\n      return NextResponse.json({\n        status: 'error',\n        message: 'Database query failed',\n        error: error.message,\n        code: error.code,\n        environment: envStatus,\n        timestamp: new Date().toISOString(),\n      }, { status: 503 });\n    }\n    \n    // Check which database we're using (local vs production)\n    const supabaseUrl = process.env.SUPABASE_URL || '';\n    const isLocal = supabaseUrl.includes('127.0.0.1') || supabaseUrl.includes('localhost');\n    const databaseType = isLocal ? 'Local Supabase' : 'Production Supabase';\n    \n    // Try to get user count to verify database has data\n    const { count, error: countError } = await supabase\n      .from('users')\n      .select('*', { count: 'exact', head: true });\n    \n    return NextResponse.json({\n      status: 'ok',\n      message: 'Database connection successful',\n      database: {\n        type: databaseType,\n        url: supabaseUrl.replace(/\\/$/, ''),\n        userCount: countError ? 'unknown' : count,\n      },\n      environment: envStatus,\n      timestamp: new Date().toISOString(),\n    });\n  } catch (error) {\n    return NextResponse.json({\n      status: 'error',\n      message: error.message || 'Unknown error',\n      stack: process.env.NODE_ENV === 'development' ? error.stack : undefined,\n      timestamp: new Date().toISOString(),\n    }, { status: 500 });\n  }\n}\n\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;AAED;AACA;;;AAEO,eAAe;IACpB,IAAI;QACF,8BAA8B;QAC9B,MAAM,SAAS,CAAC,CAAC,QAAQ,GAAG,CAAC,YAAY;QACzC,MAAM,SAAS,CAAC,CAAC,QAAQ,GAAG,CAAC,yBAAyB;QAEtD,MAAM,YAAY;YAChB,cAAc,SAAS,UAAU;YACjC,2BAA2B,SAAS,UAAU;QAChD;QAEA,IAAI,CAAC,UAAU,CAAC,QAAQ;YACtB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACvB,QAAQ;gBACR,SAAS;gBACT,aAAa;gBACb,WAAW,IAAI,OAAO,WAAW;YACnC,GAAG;gBAAE,QAAQ;YAAI;QACnB;QAEA,gCAAgC;QAChC,MAAM,WAAW,IAAA,uJAAiB;QAElC,IAAI,CAAC,UAAU;YACb,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACvB,QAAQ;gBACR,SAAS;gBACT,aAAa;gBACb,WAAW,IAAI,OAAO,WAAW;YACnC,GAAG;gBAAE,QAAQ;YAAI;QACnB;QAEA,wCAAwC;QACxC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,SACL,MAAM,CAAC,SACP,KAAK,CAAC;QAET,IAAI,OAAO;YACT,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACvB,QAAQ;gBACR,SAAS;gBACT,OAAO,MAAM,OAAO;gBACpB,MAAM,MAAM,IAAI;gBAChB,aAAa;gBACb,WAAW,IAAI,OAAO,WAAW;YACnC,GAAG;gBAAE,QAAQ;YAAI;QACnB;QAEA,yDAAyD;QACzD,MAAM,cAAc,QAAQ,GAAG,CAAC,YAAY,IAAI;QAChD,MAAM,UAAU,YAAY,QAAQ,CAAC,gBAAgB,YAAY,QAAQ,CAAC;QAC1E,MAAM,eAAe,UAAU,mBAAmB;QAElD,oDAAoD;QACpD,MAAM,EAAE,KAAK,EAAE,OAAO,UAAU,EAAE,GAAG,MAAM,SACxC,IAAI,CAAC,SACL,MAAM,CAAC,KAAK;YAAE,OAAO;YAAS,MAAM;QAAK;QAE5C,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,QAAQ;YACR,SAAS;YACT,UAAU;gBACR,MAAM;gBACN,KAAK,YAAY,OAAO,CAAC,OAAO;gBAChC,WAAW,aAAa,YAAY;YACtC;YACA,aAAa;YACb,WAAW,IAAI,OAAO,WAAW;QACnC;IACF,EAAE,OAAO,OAAO;QACd,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,QAAQ;YACR,SAAS,MAAM,OAAO,IAAI;YAC1B,OAAO,uCAAyC,MAAM,KAAK,GAAG;YAC9D,WAAW,IAAI,OAAO,WAAW;QACnC,GAAG;YAAE,QAAQ;QAAI;IACnB;AACF"}}]
}