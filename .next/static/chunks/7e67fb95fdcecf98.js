(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,80080,e=>{"use strict";var s=e.i(43476),t=e.i(71645),a=e.i(18566),l=e.i(9308),n=e.i(47791),i=e.i(18223);let r=async(e,s=null)=>{try{let t=await (0,i.deduplicatedFetch)("/api/avoma-transcription",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customerIdentifier:e,salesforceAccountId:s})}),a=t.clone();if(!t.ok){let e=await a.json();throw Error(e.error||"Failed to fetch transcription")}let l=await a.json();return{transcription:l.transcription||"",meetingCounts:l.meetingCounts||null,warning:l.warning||null}}catch(e){return(0,i.logError)("Error fetching Avoma transcription:",e),{transcription:"",meetingCounts:null,warning:"Unable to fetch Avoma transcription. Analysis will proceed with Salesforce data only."}}},c=async(e,s=null,t=[])=>{if(!s)return{account_tier:"Unknown",contract_value:"Unknown",account_manager:"Unknown"};let a=t||[],l=a.length;return{account_tier:s.accountTier||null,contract_value:s.contractValue||null,account_id:s.id,account_name:s.name,industry:s.industry||null,annual_revenue:s.annualRevenue||null,account_manager:s.ownerName||null,recent_tickets:a.map(e=>({id:e.caseNumber||e.id,subject:e.subject||null,status:e.status||null,priority:e.priority||null,type:e.type||null,reason:e.reason||null,origin:e.origin||null,created_date:e.createdDate||null,closed_date:e.closedDate||null,description:e.description||null,contact_email:e.contactEmail||null,contact_id:e.contactId||null,contact_name:e.contactName||null})),total_cases_count:l}},o=async(e,s,t,a,l,n,r=!1)=>{let c=await (0,i.deduplicatedFetch)("/api/analyze-sentiment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({transcription:e,salesforceContext:s,userId:t,accountId:a,salesforceAccountId:l,customerIdentifier:n,forceRefresh:r})}),o=c.clone();if(!c.ok)throw Error((await o.json().catch(()=>({error:"Unknown error"}))).error||`Server error: ${c.status}`);let d=await o.json();if(d.score<1||d.score>10)throw Error("Invalid sentiment score returned from API");return d};e.s(["default",0,({user:e,onSignOut:d})=>{let m=(0,a.useRouter)(),[x,h]=(0,t.useState)([]),[u,b]=(0,t.useState)(null),[p,g]=(0,t.useState)(!0),[j,f]=(0,t.useState)(""),[v,N]=(0,t.useState)(!1),[k,y]=(0,t.useState)(null),[w,_]=(0,t.useState)(null),[C,S]=(0,t.useState)(0),[L,A]=(0,t.useState)(""),[P,I]=(0,t.useState)(!1),[$,M]=(0,t.useState)(!1),[R,T]=(0,t.useState)(null),[D,E]=(0,t.useState)(null),[z,H]=(0,t.useState)(!1),[F,O]=(0,t.useState)([]),[B,U]=(0,t.useState)(!1),[V,W]=(0,t.useState)(!1),[G,q]=(0,t.useState)(!1),[J,K]=(0,t.useState)([]),[Y,Q]=(0,t.useState)(!1),[X,Z]=(0,t.useState)(!1),[ee,es]=(0,t.useState)(!1),[et,ea]=(0,t.useState)(!1),[el,en]=(0,t.useState)(!1),[ei,er]=(0,t.useState)(null),[ec,eo]=(0,t.useState)(!1),[ed,em]=(0,t.useState)(null),[ex,eh]=(0,t.useState)(!1),[eu,eb]=(0,t.useState)(null),ep=({onClose:e})=>(0,s.jsxs)("div",{className:"bg-lean-white rounded-lg shadow-lg p-8 mb-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsx)("h2",{className:"typography-heading text-lean-black",children:"How Sentiment Analysis Works"}),(0,s.jsx)("button",{onClick:e,className:"text-lean-black-60 hover:text-lean-black","aria-label":"Close help",children:(0,s.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,s.jsxs)("div",{className:"prose max-w-none space-y-6",children:[(0,s.jsxs)("section",{children:[(0,s.jsx)("h3",{className:"typography-heading text-lean-black mb-3",children:"Overview"}),(0,s.jsx)("p",{className:"typography-body text-lean-black-80",children:"L.U.C.I. uses Google Gemini AI to analyze customer sentiment by combining conversation transcripts from Avoma meetings with comprehensive Salesforce account context. The analysis provides a score from 1-10 and detailed insights about the customer relationship."})]}),(0,s.jsxs)("section",{children:[(0,s.jsx)("h3",{className:"typography-heading text-lean-black mb-3",children:"Data Sources Analyzed"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"bg-lean-green-10 rounded-lg p-4 border-l-4 border-lean-green",children:[(0,s.jsx)("h4",{className:"font-semibold text-lean-black mb-2",children:"1. Avoma Conversation Transcripts"}),(0,s.jsx)("p",{className:"text-lean-black-80 text-sm",children:"The AI analyzes the actual conversation between your team and the customer, looking for:"}),(0,s.jsxs)("ul",{className:"list-disc list-inside text-lean-black-80 text-sm mt-2 space-y-1",children:[(0,s.jsx)("li",{children:"Tone and emotional indicators (frustration, satisfaction, urgency)"}),(0,s.jsx)("li",{children:"Language patterns and sentiment signals"}),(0,s.jsx)("li",{children:"Initial concerns and how they were addressed"}),(0,s.jsx)("li",{children:"Resolution quality and final satisfaction level"})]})]}),(0,s.jsxs)("div",{className:"bg-lean-green-10 rounded-lg p-4 border-l-4 border-lean-green",children:[(0,s.jsx)("h4",{className:"font-semibold text-lean-black mb-2",children:"2. Salesforce Support Cases"}),(0,s.jsx)("p",{className:"text-lean-black-80 text-sm",children:"Recent support cases provide critical context:"}),(0,s.jsxs)("ul",{className:"list-disc list-inside text-lean-black-80 text-sm mt-2 space-y-1",children:[(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Case Count:"})," Number of recent cases (more cases may indicate issues)"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Case Descriptions:"})," Customer feedback and issue details"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Priority & Status:"})," High priority or unresolved cases signal risk"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Case Types & Reasons:"})," Patterns in support needs"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Resolution Timelines:"})," How quickly issues are resolved"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"âš ï¸ Contact Level Involvement:"})," ",(0,s.jsx)("strong",{children:"CRITICAL INDICATOR"})," - C-Level or Sr. Level executives submitting support cases is a major red flag indicating serious escalation"]})]})]}),(0,s.jsxs)("div",{className:"bg-lean-almost-white rounded-lg p-4 border-l-4 border-lean-black/20",children:[(0,s.jsx)("h4",{className:"font-semibold text-lean-black mb-2",children:"3. Account Profile Context"}),(0,s.jsx)("p",{className:"text-lean-black-80 text-sm",children:"Account characteristics help set appropriate expectations:"}),(0,s.jsxs)("ul",{className:"list-disc list-inside text-lean-black-80 text-sm mt-2 space-y-1",children:[(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Account Tier:"})," Higher tier accounts may have different expectations"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Contract Value:"})," Expiring ARR indicates renewal risk"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Industry:"})," Industry norms and standards"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Account Manager:"})," Relationship context"]})]})]}),(0,s.jsxs)("div",{className:"bg-lean-almost-white rounded-lg p-4 border-l-4 border-lean-green",children:[(0,s.jsx)("h4",{className:"font-semibold text-lean-black mb-2",children:"4. Engagement Metrics"}),(0,s.jsx)("p",{className:"text-lean-black-80 text-sm",children:"Meeting participation and frequency:"}),(0,s.jsxs)("ul",{className:"list-disc list-inside text-lean-black-80 text-sm mt-2 space-y-1",children:[(0,s.jsx)("li",{children:"Total Avoma calls/meetings with the customer"}),(0,s.jsx)("li",{children:"Number of meetings with ready transcripts"}),(0,s.jsx)("li",{children:"Engagement frequency and participation"})]})]}),(0,s.jsxs)("div",{className:"bg-lean-green-10 rounded-lg p-4 border-l-4 border-lean-green",children:[(0,s.jsx)("h4",{className:"font-semibold text-lean-black mb-2",children:"5. Contact Intelligence & Professional Context"}),(0,s.jsx)("p",{className:"text-lean-black-80 text-sm",children:"Enriched contact data from Salesforce provides deep insights:"}),(0,s.jsxs)("ul",{className:"list-disc list-inside text-lean-black-80 text-sm mt-2 space-y-1",children:[(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Contact Level Breakdown:"})," C-Level, Sr. Level, and Other contacts categorized by title"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Case Involvement by Level:"})," Which contact levels are submitting support cases (C-Level involvement = major concern)"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Job Change Signals:"})," Recent job changes or high job change likelihood indicate account risk"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Stale Relationships:"})," Contacts with no activity in 90+ days may indicate disengagement"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Engagement Signals:"})," Social media interactions with company content"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Professional Context:"})," Department, reporting structure, company size, industry, and technologies"]})]})]})]})]}),(0,s.jsxs)("section",{children:[(0,s.jsx)("h3",{className:"text-xl font-semibold text-lean-black mb-3",children:"Sentiment Score Scale"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{className:"bg-red-50 rounded-lg p-4 border-2 border-red-200",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-red-600 mb-2",children:"1-4"}),(0,s.jsx)("p",{className:"text-sm font-semibold text-lean-black mb-1",children:"At Risk"}),(0,s.jsx)("p",{className:"text-xs text-lean-black-80",children:"Very negative sentiment. Customer may be at risk of churn. Immediate attention required."})]}),(0,s.jsxs)("div",{className:"bg-yellow-50 rounded-lg p-4 border-2 border-yellow-200",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-yellow-600 mb-2",children:"5-7"}),(0,s.jsx)("p",{className:"text-sm font-semibold text-lean-black mb-1",children:"Neutral/Mixed"}),(0,s.jsx)("p",{className:"text-xs text-lean-black-80",children:"Mixed or neutral sentiment. Relationship is stable but needs attention to improve."})]}),(0,s.jsxs)("div",{className:"bg-green-50 rounded-lg p-4 border-2 border-green-200",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-lean-green mb-2",children:"8-10"}),(0,s.jsx)("p",{className:"text-sm font-semibold text-lean-black mb-1",children:"Positive"}),(0,s.jsx)("p",{className:"text-xs text-lean-black-80",children:"Strong positive sentiment. Customer is satisfied and may be a strong advocate."})]})]})]}),(0,s.jsxs)("section",{children:[(0,s.jsx)("h3",{className:"text-xl font-semibold text-lean-black mb-3",children:"What the Analysis Includes"}),(0,s.jsx)("p",{className:"text-lean-black-80 leading-relaxed mb-3",children:"Each sentiment analysis provides two levels of detail:"}),(0,s.jsxs)("div",{className:"space-y-3 mb-3",children:[(0,s.jsxs)("div",{className:"bg-lean-almost-white rounded-lg p-3",children:[(0,s.jsx)("p",{className:"font-semibold text-lean-black mb-1",children:"Executive Summary (150 words)"}),(0,s.jsx)("p",{className:"text-sm text-lean-black-80",children:"A concise, high-level overview for C-level executives focusing on overall sentiment, top critical factors, immediate actions, and relationship health status."})]}),(0,s.jsxs)("div",{className:"bg-lean-almost-white rounded-lg p-3",children:[(0,s.jsx)("p",{className:"font-semibold text-lean-black mb-1",children:"Comprehensive Analysis (500-800 words)"}),(0,s.jsx)("p",{className:"text-sm text-lean-black-80",children:"A detailed, in-depth analysis for CSMs and Account Managers including detailed factor breakdown, specific concerns/positive signals with examples, relationship trajectory with evidence, contact level involvement analysis, support case patterns, engagement metrics, risk factors, opportunities, and detailed recommendations."})]})]}),(0,s.jsx)("p",{className:"text-lean-black-80 leading-relaxed mb-2",children:"Both analyses include:"}),(0,s.jsxs)("ul",{className:"list-disc list-inside text-lean-black-80 space-y-2",children:[(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Key Factors:"})," What most influenced the sentiment score"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Specific Concerns or Signals:"})," Identified issues or positive indicators"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Relationship Trajectory:"})," Whether sentiment is improving, declining, or stable"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Contact Level Analysis:"})," Critical assessment of which contact levels are involved in support cases"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Actionable Insights:"})," Detailed recommendations for account management"]})]})]}),(0,s.jsxs)("section",{children:[(0,s.jsx)("h3",{className:"text-xl font-semibold text-lean-black mb-3",children:"Best Practices"}),(0,s.jsxs)("div",{className:"bg-lean-almost-white rounded-lg p-4 space-y-2",children:[(0,s.jsxs)("p",{className:"text-sm text-lean-black-80",children:[(0,s.jsx)("strong",{children:"âœ“ Regular Monitoring:"})," Check sentiment after important meetings or when support cases are resolved"]}),(0,s.jsxs)("p",{className:"text-sm text-lean-black-80",children:[(0,s.jsx)("strong",{children:"âœ“ Context Matters:"})," Review the detailed data sources to understand what influenced the score"]}),(0,s.jsxs)("p",{className:"text-sm text-lean-black-80",children:[(0,s.jsx)("strong",{children:"âœ“ Action on Low Scores:"})," Scores of 4 or below indicate immediate attention is needed"]}),(0,s.jsxs)("p",{className:"text-sm text-lean-black-80",children:[(0,s.jsx)("strong",{children:"âœ“ Track Trends:"})," Monitor sentiment over time to identify improving or declining relationships"]})]})]}),(0,s.jsx)("section",{className:"pt-4 border-t border-lean-black/20",children:(0,s.jsxs)("p",{className:"text-sm text-lean-black-60",children:[(0,s.jsx)("strong",{children:"AI Model:"})," Google Gemini (auto-discovered best available model)",(0,s.jsx)("br",{}),(0,s.jsx)("strong",{children:"Analysis Framework:"})," 6-dimensional analysis (Conversation, Support Context, Account Profile, Engagement, Contact Intelligence, Overall Assessment)"]})})]})]}),eg=(0,t.useCallback)(async e=>{if(!e){O([]),U(!1),W(!1);return}let s=e.salesforceId||(e.id&&!e.id.includes("-")&&(15===e.id.length||18===e.id.length)?e.id:null);if(!s){O([]),U(!1),W(!1);return}U(!0),W(!0);try{let t=new URLSearchParams({salesforceAccountId:s,accountId:e.id}),a=await (0,i.deduplicatedFetch)(`/api/salesforce-cases?${t}`),l=a.clone();if(a.ok){let e=await l.json(),s=e.cases||[];W(!0===e.cached),O(s)}else{let e=await l.json().catch(()=>({}));(0,i.logError)("Error fetching cases:",Error(e.message||e.error||`HTTP ${a.status}`)),O([])}}catch(e){(0,i.logError)("Error fetching cases:",e),O([])}finally{U(!1)}},[]),ej=(0,t.useCallback)(async e=>{if(!e){K([]),Q(!1),Z(!1);return}let s=e.salesforceId||(e.id&&!e.id.includes("-")&&(15===e.id.length||18===e.id.length)?e.id:null);if(!s){K([]),Q(!1),Z(!1);return}Q(!0),Z(!0);try{let t=new URLSearchParams({salesforceAccountId:s,accountId:e.id}),a=await (0,i.deduplicatedFetch)(`/api/salesforce-contacts?${t}`),l=a.clone();if(a.ok){let e=await l.json(),s=e.contacts||[];Z(!0===e.cached),e.cached,K(s),(0,i.isProduction)()}else{let e=await a.json().catch(()=>({}));(0,i.logError)("Error fetching contacts:",Error(e.message||e.error||`HTTP ${a.status}`)),K([])}}catch(e){(0,i.logError)("Error fetching contacts:",e),K([])}finally{Q(!1)}},[]);(0,t.useEffect)(()=>{let s=async()=>{if(!e?.id&&!e?.email)return void g(!1);try{g(!0),y(null);let s=new URLSearchParams({userId:e.id||"",email:e.email||"",role:e.role||"",cacheOnly:"true"}),t=await (0,i.deduplicatedFetch)(`/api/salesforce-accounts?${s}`),a=t.clone();if(!t.ok){let e=await a.json().catch(()=>({}));if(e.error&&!e.error.includes("not found"))throw Error(e.message||e.error||"Failed to fetch accounts");h([]),g(!1);return}let l=(await a.json()).accounts||[];h(l),l.length>0&&(b(l[0]),f(l[0].name)),(0,i.trackAnalytics)("cached_accounts_loaded",{count:l.length,userId:e.id})}catch(e){(0,i.logError)("Error fetching cached accounts:",e),h([])}finally{g(!1)}};$||s()},[e,$]),(0,t.useEffect)(()=>{u?(eg(u),ej(u)):(O([]),q(!1),K([]),es(!1))},[u]);let ef=(0,t.useCallback)(async e=>{if(!e)return void er(null);let s=e.salesforceId||(e.id&&!e.id.includes("-")&&(15===e.id.length||18===e.id.length)?e.id:null);if(s||e.id){eo(!0);try{let t=new URLSearchParams({accountId:e.id||"",salesforceAccountId:s||"",limit:"50",days:"365"}),a=await (0,i.deduplicatedFetch)(`/api/sentiment-analysis?${t}`),l=a.clone();if(a.ok){let e=await l.json();er(e)}else{let e=await l.json().catch(()=>({}));(0,i.logError)("Failed to fetch sentiment history:",{status:a.status,error:e}),er(null)}}catch(e){(0,i.logError)("Error fetching sentiment history:",e),er(null)}finally{eo(!1)}}},[]),ev=(0,t.useCallback)(async e=>{if(!e)return void em(null);let s=e.salesforceId||(e.id&&!e.id.includes("-")&&(15===e.id.length||18===e.id.length)?e.id:null);if(!s&&!e.id)return void em(null);eh(!0);try{let t=new URLSearchParams({accountId:e.id||"",salesforceAccountId:s||"",limit:"1",days:"365"}),a=await (0,i.deduplicatedFetch)(`/api/sentiment-analysis?${t}`),l=a.clone();if(a.ok){let e=await l.json();e.history&&e.history.length>0?em(e.history[0]):em(null)}else em(null)}catch(e){(0,i.logError)("Error checking cached sentiment:",e),em(null)}finally{eh(!1)}},[]);(0,t.useEffect)(()=>{u&&!el?ev(u):em(null)},[u,el,ev]),(0,t.useEffect)(()=>{el&&u&&ef(u)},[el,u,ef]);let eN=async s=>{if(!s||s.trim().length<2)return void y("Please enter at least 2 characters to search");try{I(!0),y(null);let t=new URLSearchParams({search:s.trim(),userId:e?.id||""}),a=await (0,i.deduplicatedFetch)(`/api/salesforce-accounts?${t}`),l=a.clone();if(!a.ok){let e=await l.json().catch(()=>({}));throw Error(e.message||e.error||"Failed to search accounts")}let n=await l.json();h(n.accounts||[]),M(!0),n.accounts&&n.accounts.length>0?(b(n.accounts[0]),f(n.accounts[0].name)):(b(null),f("")),(0,i.trackAnalytics)("accounts_searched",{searchTerm:s,count:n.accounts?.length||0,userId:e?.id})}catch(e){(0,i.logError)("Error searching accounts:",e),y(e.message||"Failed to search accounts. Please try again.")}finally{I(!1)}},ek=(0,t.useCallback)(async(s=0,t=!1)=>{N(!0),y(null),0===s&&_(null);try{let[s,a]=await Promise.all([r(j,u?.salesforceId||u?.id),c(j,u,F)]),l=s.transcription||"",n=s.meetingCounts||null;if(s.warning||!l){let e=s.warning||"No Avoma transcription available. Analysis will proceed with Salesforce account data only.";eb(e)}else eb(null);let d=J.map(e=>{let s=e.title||e.linkedinProfile?.current_title||"",t=(0,i.categorizeContactLevel)(s);return{...e,contactLevel:t,title:s}}),m=new Set,x=new Set;(a.recent_tickets||[]).forEach(e=>{e.contact_email&&m.add(e.contact_email.toLowerCase()),e.contact_id&&x.add(e.contact_id)});let h=d.map(e=>{let s=e.email&&m.has(e.email.toLowerCase()),t=e.id&&x.has(e.id);return{...e,involvedInCases:s||t}}),b={"C-Level":0,"Sr. Level":0,Other:0},p={"C-Level":0,"Sr. Level":0,Other:0};h.forEach(e=>{b[e.contactLevel]=(b[e.contactLevel]||0)+1,e.involvedInCases&&(p[e.contactLevel]=(p[e.contactLevel]||0)+1)});let g={contacts:h.filter(e=>e.linkedinURL||e.linkedinProfile||e.email||e.name).map(e=>({name:e.name||`${e.firstName||""} ${e.lastName||""}`.trim(),email:e.email,linkedin_url:e.linkedinURL||e.linkedin_url,contact_level:e.contactLevel,involved_in_cases:e.involvedInCases,department:e.department,reports_to_name:e.reports_to_name,owner_name:e.owner_name,last_activity_date:e.last_activity_date,created_date:e.created_date,lead_source:e.lead_source,mailing_city:e.mailing_city,mailing_state:e.mailing_state,mailing_country:e.mailing_country,current_title:e.title||e.linkedinProfile?.current_title,current_company:e.linkedinProfile?.current_company||e.account_name,job_changed_recently:e.linkedinProfile?.job_changed_recently||!1,days_in_current_role:e.linkedinProfile?.days_in_current_role,job_change_likelihood:e.linkedinProfile?.job_change_likelihood,profile_updated_recently:!!e.linkedinProfile?.profile_updated_at&&new Date-new Date(e.linkedinProfile.profile_updated_at)<2592e6,company_industry:e.linkedinProfile?.company_industry,company_size:e.linkedinProfile?.company_size,company_revenue:e.linkedinProfile?.company_revenue,company_technologies:e.linkedinProfile?.company_technologies||[],previous_companies:e.linkedinProfile?.previous_companies||[],previous_titles:e.linkedinProfile?.previous_titles||[],email_status:e.linkedinProfile?.email_status,phone_status:e.linkedinProfile?.phone_status,email_verified:e.linkedinProfile?.email_verified,phone_verified:e.linkedinProfile?.phone_verified,engagement_with_company:{posts_about_company:e.linkedinProfile?.posts_about_company||0,comments_on_company_posts:e.linkedinProfile?.comments_on_company_posts||0,shares_of_company_content:e.linkedinProfile?.shares_of_company_content||0,reactions_to_company_posts:e.linkedinProfile?.reactions_to_company_posts||0},email_open_rate:e.linkedinProfile?.email_open_rate,email_click_rate:e.linkedinProfile?.email_click_rate,response_rate:e.linkedinProfile?.response_rate,last_contacted:e.linkedinProfile?.last_contacted,last_engaged:e.linkedinProfile?.last_engaged})),total_contacts_with_linkedin:J.filter(e=>e.linkedinURL||e.linkedin_url).length,contacts_with_enriched_data:J.filter(e=>e.linkedinProfile).length,contact_level_counts:b,case_involved_by_level:p,total_contacts:J.length},f={...a,total_cases_count:a.total_cases_count||0,total_avoma_calls:n?.total||0,ready_avoma_calls:n?.ready||0,linkedin_data:g.contacts.length>0?g:null,contact_levels:{c_level_count:b["C-Level"],sr_level_count:b["Sr. Level"],other_count:b.Other,c_level_in_cases:p["C-Level"],sr_level_in_cases:p["Sr. Level"],other_in_cases:p.Other}};E({transcription:l,salesforceContext:f,transcriptionPreview:l.length>500?l.substring(0,500)+"...":l});let v=u?.id,N=u?.salesforceId||(u?.id&&!u.id.includes("-")&&(15===u.id.length||18===u.id.length)?u.id:null),k=await o(l,f,e?.id,v,N,j,t);_(k),S(0),T({hasTranscription:!!l&&l.length>0,transcriptionLength:l.length,hasAccountData:!!u,accountName:u?.name||j,casesCount:f.total_cases_count||0,avomaCallsTotal:f.total_avoma_calls||0,avomaCallsReady:f.ready_avoma_calls||0,hasCases:(f.recent_tickets||[]).length>0,hasLinkedIn:!!f.linkedin_data&&f.linkedin_data.contacts.length>0,linkedinContactsCount:f.linkedin_data?.contacts.length||0,linkedinEnrichedCount:f.linkedin_data?.contacts_with_enriched_data||0}),en(!0),setTimeout(()=>{u&&(ef(u),ev(u))},1e3),(0,i.trackAnalytics)("sentiment_analyzed",{customerIdentifier:j,score:k.score,hasTranscription:!!l,casesCount:f.total_cases_count||0,avomaCallsCount:f.total_avoma_calls||0})}catch(t){let e=t.message||"An error occurred while analyzing sentiment";y(e),(0,i.logError)("Sentiment analysis error:",t),s<3&&(t.message?.includes("timeout")||t.message?.includes("network"))?(S(s+1),(0,i.trackAnalytics)("sentiment_analysis_retry",{attempt:s+1})):(S(0),(0,i.trackAnalytics)("sentiment_analysis_failed",{error:e}))}finally{N(!1)}},[j,u,J,F,ef]);return el&&w?(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(({sentiment:e,dataSources:a,analysisData:l,selectedAccount:r,cases:c,contacts:o,sentimentHistory:d,historyLoading:x,avomaWarning:h,onBack:u,onShowHelp:b,onCloseHelp:p,showHelp:g})=>{var j,f;let[v,N]=(0,t.useState)(!1);(0,t.useEffect)(()=>{g&&setTimeout(()=>{let e=document.getElementById("help-section");e&&e.scrollIntoView({behavior:"smooth",block:"start"})},100)},[g]);let k=o.map(e=>{let s=e.title||e.linkedinProfile?.current_title||"";return{...e,contactLevel:(0,i.categorizeContactLevel)(s),title:s}}),y=new Set,w=new Set;(c||[]).forEach(e=>{e.contactEmail&&y.add(e.contactEmail.toLowerCase()),e.contactId&&w.add(e.contactId)});let _=k.map(e=>{let s=e.email&&y.has(e.email.toLowerCase()),t=e.id&&w.has(e.id);return{...e,involvedInCases:s||t}}),C={"C-Level":_.filter(e=>"C-Level"===e.contactLevel),"Sr. Level":_.filter(e=>"Sr. Level"===e.contactLevel),Other:_.filter(e=>"Other"===e.contactLevel)},S={"C-Level":C["C-Level"].length,"Sr. Level":C["Sr. Level"].length,Other:C.Other.length},L={"C-Level":C["C-Level"].filter(e=>e.involvedInCases).length,"Sr. Level":C["Sr. Level"].filter(e=>e.involvedInCases).length,Other:C.Other.filter(e=>e.involvedInCases).length};return(0,s.jsxs)("div",{className:"min-h-screen bg-lean-almost-white flex flex-col",children:[(0,s.jsx)("header",{className:"bg-lean-black px-4 sm:px-6 lg:px-8 py-4 flex-shrink-0",children:(0,s.jsxs)("div",{className:"max-w-6xl mx-auto flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("img",{src:`/ld-logo-abbr-green.png?v=${(0,i.getBuildVersion)()}`,alt:"LeanData Logo",className:"h-12 w-auto flex-shrink-0"},`logo-${(0,i.getBuildVersion)()}`),(0,s.jsxs)("div",{className:"text-left",children:[(0,s.jsx)("h1",{className:"typography-heading text-[#f7f7f7] mb-1",children:"L.U.C.I."}),(0,s.jsx)("p",{className:"text-sm text-[#f7f7f7]",children:"LeanData Unified Customer Intelligence"})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("button",{onClick:()=>{m.push("/user")},className:"px-4 py-2 text-sm font-medium text-[#f7f7f7] bg-lean-green rounded-lg hover:bg-lean-green/90 focus:outline-none focus:ring-2 focus:ring-lean-green transition-all","aria-label":"Manage my accounts",children:"My Accounts"}),(0,s.jsx)("button",{onClick:()=>{m.push("/admin")},className:"px-4 py-2 text-sm font-medium text-[#f7f7f7] bg-blue-600 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all","aria-label":"Go to admin panel",children:"Admin"}),(0,s.jsx)("button",{onClick:e=>{e.preventDefault(),b&&"function"==typeof b&&b()},className:"px-4 py-2 text-sm font-medium text-[#f7f7f7] bg-lean-green rounded-lg hover:bg-lean-green/90 focus:outline-none focus:ring-2 focus:ring-lean-green transition-all","aria-label":"Show help and explanation",type:"button",children:"Help"})]})]})}),(0,s.jsx)("main",{className:"flex-1 px-4 sm:px-6 lg:px-8 py-12",children:(0,s.jsxs)("div",{className:"max-w-6xl mx-auto",children:[g&&(0,s.jsx)("div",{id:"help-section",children:(0,s.jsx)(ep,{onClose:()=>p&&p()})}),(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsxs)("button",{onClick:u,className:"mb-6 flex items-center gap-2 text-lean-black-70 hover:text-lean-black transition-colors","aria-label":"Back to account selection",children:[(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),(0,s.jsx)("span",{className:"font-medium",children:"Back to Account Selection"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"typography-heading text-lean-black mb-2",children:"Sentiment Analysis Results"}),r?(0,s.jsx)("button",{onClick:()=>{let e=r.salesforceId||r.id;m.push(`/account/${e}/data`)},className:"typography-body text-lean-black-70 hover:text-lean-green hover:underline transition-colors text-left",children:r.name||"Account Analysis"}):(0,s.jsx)("p",{className:"typography-body text-lean-black-70",children:"Account Analysis"})]})]}),h&&(0,s.jsx)("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6 rounded-lg",role:"alert",children:(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsx)("svg",{className:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),(0,s.jsx)("div",{className:"ml-3",children:(0,s.jsxs)("p",{className:"text-sm text-yellow-700",children:[(0,s.jsx)("strong",{children:"Note:"})," ",h]})})]})}),(0,s.jsxs)("div",{className:"bg-lean-white rounded-lg shadow-lg p-8 mb-6",role:"region","aria-live":"polite","aria-label":"Sentiment analysis results",children:[(0,s.jsxs)("div",{className:`text-center mb-6 p-8 rounded-xl border-2 ${(j=e.score)<=4?"text-red-600 bg-red-50 border-red-200":j<=7?"text-yellow-600 bg-yellow-50 border-yellow-200":"text-lean-green bg-lean-green-10 border-lean-green/20"}`,role:"status",children:[(0,s.jsx)("div",{className:"text-6xl font-bold mb-2","aria-label":`Sentiment score: ${e.score} out of 10`,children:e.score}),(0,s.jsx)("div",{className:"text-xl font-semibold text-lean-black-70",children:"/ 10"})]}),(0,s.jsx)("div",{className:`rounded-lg p-6 ${(f=e.score)<=4?"bg-red-100":f<=7?"bg-yellow-100":"bg-lean-green-10"}`,children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[e.score>=8?(0,s.jsx)(n.TrendingUpIcon,{className:"w-6 h-6 text-lean-green flex-shrink-0 mt-1"}):(0,s.jsx)(n.TrendingDownIcon,{className:"w-6 h-6 text-red-600 flex-shrink-0 mt-1"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("h3",{className:"font-semibold text-lean-black",children:"Executive Summary"}),(0,s.jsx)("span",{className:"text-xs text-lean-black-60 bg-lean-almost-white px-2 py-1 rounded",children:"C-Level Brief"})]}),(0,s.jsx)("p",{className:"text-lean-black-80 leading-relaxed",children:e.summary})]})]})})]}),e.comprehensiveAnalysis&&(0,s.jsxs)("div",{className:"bg-lean-white rounded-lg shadow-lg p-8 mb-6 border-l-4 border-lean-green",children:[(0,s.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold text-lean-black",children:"Comprehensive Analysis"}),(0,s.jsx)("span",{className:"text-xs text-lean-black-60 bg-blue-50 px-2 py-1 rounded border border-blue-200",children:"For CSMs & Account Managers"})]})}),(0,s.jsx)("div",{className:"prose max-w-none",children:(0,s.jsx)("div",{className:"text-lean-black-80 leading-relaxed whitespace-pre-wrap",children:e.comprehensiveAnalysis})})]}),d&&d.history&&d.history.length>0&&(0,s.jsxs)("div",{className:"bg-lean-white rounded-lg shadow-lg p-8 mb-6",children:[(0,s.jsx)("h3",{className:"typography-heading text-lean-black mb-4",children:"Sentiment History"}),d.stats&&(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[(0,s.jsxs)("div",{className:"bg-lean-almost-white rounded-lg p-4",children:[(0,s.jsx)("div",{className:"text-sm text-lean-black-70 mb-1",children:"Average Score"}),(0,s.jsx)("div",{className:"text-2xl font-bold text-lean-black",children:d.stats.average.toFixed(1)}),(0,s.jsx)("div",{className:"text-xs text-lean-black-60",children:"/ 10"})]}),(0,s.jsxs)("div",{className:"bg-lean-almost-white rounded-lg p-4",children:[(0,s.jsx)("div",{className:"text-sm text-lean-black-70 mb-1",children:"Range"}),(0,s.jsxs)("div",{className:"text-2xl font-bold text-lean-black",children:[d.stats.min," - ",d.stats.max]}),(0,s.jsx)("div",{className:"text-xs text-lean-black-60",children:"Min - Max"})]}),(0,s.jsxs)("div",{className:"bg-lean-almost-white rounded-lg p-4",children:[(0,s.jsx)("div",{className:"text-sm text-lean-black-70 mb-1",children:"Total Analyses"}),(0,s.jsx)("div",{className:"text-2xl font-bold text-lean-black",children:d.stats.total}),(0,s.jsx)("div",{className:"text-xs text-lean-black-60",children:"Last 365 days"})]}),(0,s.jsxs)("div",{className:"bg-lean-almost-white rounded-lg p-4",children:[(0,s.jsx)("div",{className:"text-sm text-lean-black-70 mb-1",children:"Trend"}),(0,s.jsx)("div",{className:`text-2xl font-bold ${"improving"===d.stats.trend?"text-lean-green":"declining"===d.stats.trend?"text-red-600":"text-yellow-600"}`,children:"improving"===d.stats.trend?"â†‘ Improving":"declining"===d.stats.trend?"â†“ Declining":"â†’ Stable"}),d.stats.recentAverage>0&&d.stats.previousAverage>0&&(0,s.jsxs)("div",{className:"text-xs text-lean-black-60",children:[d.stats.recentAverage.toFixed(1)," vs ",d.stats.previousAverage.toFixed(1)]})]})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h4",{className:"text-sm font-semibold text-lean-black-80 mb-3",children:"Score Over Time"}),(0,s.jsx)("div",{className:"bg-lean-almost-white rounded-lg p-4",style:{height:"200px",position:"relative"},children:(0,s.jsx)("div",{className:"flex items-end justify-between h-full gap-1",children:d.history.slice(0,20).reverse().map((e,t)=>{let a=e.score/10*100,l=e.score<=4?"#ef4444":e.score<=7?"#eab308":"#22c55e";return(0,s.jsxs)("button",{onClick:()=>{e.id&&m.push(`/sentiment/${e.id}`)},className:"flex-1 flex flex-col items-center cursor-pointer",title:`Score: ${e.score} on ${new Date(e.analyzed_at).toLocaleDateString()} - Click to view details`,disabled:!e.id,children:[(0,s.jsx)("div",{className:"w-full rounded-t transition-all hover:opacity-80",style:{height:`${a}%`,backgroundColor:l,minHeight:"4px"}}),(0,s.jsx)("div",{className:"text-xs text-lean-black-60 mt-1 transform -rotate-45 origin-top-left whitespace-nowrap",style:{writingMode:"vertical-rl"},children:new Date(e.analyzed_at).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]},e.id||t)})})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"text-sm font-semibold text-lean-black-80 mb-3",children:"Recent Analyses"}),(0,s.jsx)("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:d.history.slice(0,10).map(e=>(0,s.jsx)("button",{onClick:()=>{e.id&&m.push(`/sentiment/${e.id}`)},className:"w-full flex items-center justify-between p-3 bg-lean-almost-white rounded-lg border border-lean-black/20 hover:bg-lean-green-10 hover:border-lean-green/30 transition-colors text-left",disabled:!e.id,children:(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:`text-lg font-bold ${e.score<=4?"text-red-600":e.score<=7?"text-yellow-600":"text-lean-green"}`,children:e.score}),(0,s.jsx)("span",{className:"text-sm text-lean-black-70",children:"/ 10"}),(0,s.jsx)("span",{className:"text-xs text-lean-black-60 ml-2",children:new Date(e.analyzed_at).toLocaleString()})]}),(0,s.jsx)("p",{className:"text-xs text-lean-black-70 mt-1 line-clamp-1",children:e.summary})]})},e.id))})]})]}),x&&(0,s.jsx)("div",{className:"bg-lean-white rounded-lg shadow-lg p-8 mb-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-center",children:[(0,s.jsx)(n.LoaderIcon,{className:"w-6 h-6 animate-spin text-blue-600 mr-3"}),(0,s.jsx)("p",{className:"text-lean-black-70",children:"Loading sentiment history..."})]})}),a&&(0,s.jsxs)("div",{className:"bg-lean-white rounded-lg shadow-lg p-8 mb-6",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold text-lean-black mb-4",children:"Analysis Data Sources"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm mb-6",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[a.hasTranscription?(0,s.jsx)("svg",{className:"w-5 h-5 text-lean-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}):(0,s.jsx)("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),(0,s.jsx)("span",{className:"font-medium text-lean-black-80",children:"Avoma Transcription"})]}),a.hasTranscription?(0,s.jsxs)("p",{className:"text-lean-black-70 ml-7",children:[a.transcriptionLength.toLocaleString()," characters from customer call/meeting",a.avomaCallsTotal>0&&(0,s.jsxs)("span",{className:"block mt-1 text-xs text-lean-black-60",children:["Found ",a.avomaCallsTotal," meeting",1!==a.avomaCallsTotal?"s":"",a.avomaCallsReady>0&&` (${a.avomaCallsReady} with ready transcripts)`]})]}):(0,s.jsx)("p",{className:"text-lean-black-60 ml-7 text-xs",children:"No transcription available"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[a.hasAccountData?(0,s.jsx)("svg",{className:"w-5 h-5 text-lean-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}):(0,s.jsx)("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),(0,s.jsx)("span",{className:"font-medium text-lean-black-80",children:"Salesforce Account"})]}),a.hasAccountData?(0,s.jsxs)("p",{className:"text-lean-black-70 ml-7",children:[(0,s.jsx)("button",{onClick:()=>{let e=r?.salesforceId||r?.id;e&&m.push(`/account/${e}/data`)},className:"text-blue-600 hover:text-blue-800 hover:underline transition-colors",children:a.accountName}),a.casesCount>0&&(0,s.jsxs)("span",{className:"block mt-1 text-xs text-lean-black-60",children:[a.casesCount," support case",1!==a.casesCount?"s":""," found"]})]}):(0,s.jsx)("p",{className:"text-lean-black-60 ml-7 text-xs",children:"No account data available"})]})]}),(0,s.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-100",children:[(0,s.jsxs)("p",{className:"text-xs text-lean-black-60 mb-3",children:[(0,s.jsx)("strong",{children:"AI Analysis:"})," Powered by Google Gemini 2.5 Flash, analyzing conversation tone, customer language, and account context to generate sentiment score."]}),(0,s.jsx)("button",{onClick:()=>N(!v),className:"text-xs text-blue-600 hover:text-blue-800 font-medium underline flex items-center gap-1","aria-expanded":v,"aria-label":v?"Hide data details":"Show data details",children:v?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})}),"Hide Data Used in Analysis"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}),"Show Data Used in Analysis"]})})]})]}),v&&l&&(0,s.jsxs)("div",{className:"bg-lean-white rounded-lg shadow-lg p-8 mb-6",children:[(0,s.jsx)("h4",{className:"text-lg font-semibold text-lean-black mb-4",children:"Detailed Data Used in Analysis"}),(0,s.jsxs)("div",{className:"bg-lean-almost-white rounded-lg p-4 mb-4",children:[(0,s.jsx)("h5",{className:"text-sm font-semibold text-gray-800 mb-2",children:"Avoma Transcription"}),l.transcription&&l.transcription.length>0?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("p",{className:"text-xs text-lean-black-80 mb-2",children:[(0,s.jsx)("span",{className:"font-medium",children:"Characters:"})," ",l.transcription.length.toLocaleString()," |",(0,s.jsx)("span",{className:"font-medium ml-2",children:"Words:"})," ",l.transcription.split(/\s+/).filter(Boolean).length.toLocaleString()]}),(0,s.jsx)("div",{className:"bg-lean-white border border-lean-black/20 rounded-md p-3 text-xs text-gray-800 max-h-60 overflow-y-auto",children:(0,s.jsx)("pre",{className:"whitespace-pre-wrap font-mono",children:l.transcription})})]}):(0,s.jsx)("p",{className:"text-xs text-lean-black-60",children:"No transcription data was available for analysis."})]}),(0,s.jsxs)("div",{className:"bg-lean-almost-white rounded-lg p-4 mb-4",children:[(0,s.jsx)("h5",{className:"text-sm font-semibold text-gray-800 mb-2",children:"Salesforce Account Context"}),l.salesforceContext?(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-x-4 gap-y-2 text-xs",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium text-lean-black-70",children:"Account Name:"}),(0,s.jsx)("button",{onClick:()=>{let e=r?.salesforceId||r?.id||l.salesforceContext?.account_id;e&&m.push(`/account/${e}/data`)},className:"ml-2 text-blue-600 hover:text-blue-800 hover:underline transition-colors",children:l.salesforceContext.account_name||"N/A"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium text-lean-black-70",children:"Tier:"}),(0,s.jsx)("span",{className:"ml-2 text-lean-black",children:l.salesforceContext.account_tier||"N/A"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium text-lean-black-70",children:"Contract Value:"}),(0,s.jsx)("span",{className:"ml-2 text-lean-black",children:(0,i.formatCurrency)(l.salesforceContext.contract_value)||"N/A"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium text-lean-black-70",children:"Industry:"}),(0,s.jsx)("span",{className:"ml-2 text-lean-black",children:l.salesforceContext.industry||"N/A"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium text-lean-black-70",children:"Annual Revenue:"}),(0,s.jsx)("span",{className:"ml-2 text-lean-black",children:l.salesforceContext.annual_revenue?`$${l.salesforceContext.annual_revenue.toLocaleString()}`:"N/A"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium text-lean-black-70",children:"Account Manager:"}),(0,s.jsx)("span",{className:"ml-2 text-lean-black",children:l.salesforceContext.account_manager||"N/A"})]}),void 0!==l.salesforceContext.total_cases_count&&(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium text-lean-black-70",children:"Support Cases:"}),(0,s.jsx)("span",{className:"ml-2 text-lean-black",children:l.salesforceContext.total_cases_count})]}),void 0!==l.salesforceContext.total_avoma_calls&&(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium text-lean-black-70",children:"Avoma Calls (Total):"}),(0,s.jsx)("span",{className:"ml-2 text-lean-black",children:l.salesforceContext.total_avoma_calls})]}),void 0!==l.salesforceContext.ready_avoma_calls&&(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium text-lean-black-70",children:"Avoma Calls (Ready):"}),(0,s.jsx)("span",{className:"ml-2 text-lean-black",children:l.salesforceContext.ready_avoma_calls})]})]}):(0,s.jsx)("p",{className:"text-xs text-lean-black-60",children:"No Salesforce account context was available for analysis."})]}),l.salesforceContext?.recent_tickets&&l.salesforceContext.recent_tickets.length>0&&(0,s.jsxs)("div",{className:"bg-lean-almost-white rounded-lg p-4 mb-4",children:[(0,s.jsxs)("h5",{className:"text-sm font-semibold text-gray-800 mb-2",children:["Recent Support Cases (",l.salesforceContext.recent_tickets.length,")"]}),(0,s.jsx)("div",{className:"space-y-2 max-h-60 overflow-y-auto pr-2",children:l.salesforceContext.recent_tickets.map((e,t)=>(0,s.jsxs)("div",{className:"text-xs bg-lean-white rounded p-2 border border-lean-black/20",children:[(0,s.jsxs)("a",{href:`https://leandata.my.salesforce.com/500/o/Case/d?id=${e.id}`,target:"_blank",rel:"noopener noreferrer",className:"font-medium text-blue-700 hover:text-blue-900 hover:underline flex items-center gap-1","aria-label":`View case ${e.caseNumber} in Salesforce`,children:[e.caseNumber||e.id," - ",e.subject||"No Subject",(0,s.jsx)("svg",{className:"w-3 h-3 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})]}),(0,s.jsxs)("p",{className:"text-lean-black-70 mt-1",children:["Status: ",(0,s.jsx)("span",{className:`font-semibold ${"Closed"===e.status?"text-lean-green":"text-blue-600"}`,children:e.status}),(0,s.jsx)("span",{className:"mx-2",children:"|"})," Priority: ",(0,s.jsx)("span",{className:`font-semibold ${["High","Critical"].includes(e.priority)?"text-red-600":"text-lean-black-70"}`,children:e.priority||"N/A"})]}),(0,s.jsxs)("p",{className:"text-lean-black-60 mt-1",children:["Created: ",new Date(e.created_date).toLocaleDateString()," ",e.closed_date?`| Closed: ${new Date(e.closed_date).toLocaleDateString()}`:""]}),e.description&&(0,s.jsxs)("p",{className:"text-lean-black-80 mt-2 italic line-clamp-2",title:e.description,children:['"',e.description,'"']})]},t))})]}),l.salesforceContext?.linkedin_data&&l.salesforceContext.linkedin_data.contacts.length>0&&(0,s.jsxs)("div",{className:"bg-lean-almost-white rounded-lg p-4 mb-4",children:[(0,s.jsxs)("h5",{className:"text-sm font-semibold text-gray-800 mb-2",children:["LinkedIn Professional Context (",l.salesforceContext.linkedin_data.contacts.length," contacts)"]}),(0,s.jsx)("div",{className:"space-y-2 max-h-60 overflow-y-auto pr-2",children:l.salesforceContext.linkedin_data.contacts.map((e,t)=>(0,s.jsxs)("div",{className:"text-xs bg-lean-white rounded p-2 border border-lean-black/20",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,s.jsx)("span",{className:"font-medium text-lean-black",children:e.name}),e.linkedin_url&&(0,s.jsxs)("a",{href:e.linkedin_url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 hover:underline flex items-center gap-1","aria-label":`View ${e.name} on LinkedIn`,children:[(0,s.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{d:"M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"})}),"LinkedIn"]})]}),e.current_title&&(0,s.jsxs)("p",{className:"text-lean-black-80 mt-1",children:[(0,s.jsx)("span",{className:"font-medium",children:"Title:"})," ",e.current_title,e.current_company&&` at ${e.current_company}`]}),e.job_changed_recently&&(0,s.jsx)("p",{className:"text-red-600 text-xs font-semibold mt-1",children:"âš ï¸ Recent job change detected"}),e.profile_updated_recently&&(0,s.jsx)("p",{className:"text-yellow-600 text-xs mt-1",children:"ðŸ“ Profile recently updated"}),e.engagement_with_company&&(e.engagement_with_company.posts_about_company>0||e.engagement_with_company.comments_on_company_posts>0||e.engagement_with_company.shares_of_company_content>0||e.engagement_with_company.reactions_to_company_posts>0)&&(0,s.jsxs)("p",{className:"text-lean-black-70 text-xs mt-1",children:["Engagement: ",e.engagement_with_company.posts_about_company," posts,",e.engagement_with_company.comments_on_company_posts," comments,",e.engagement_with_company.shares_of_company_content," shares,",e.engagement_with_company.reactions_to_company_posts," reactions"]})]},t))})]}),(0,s.jsxs)("div",{className:"bg-lean-almost-white rounded-lg p-4",children:[(0,s.jsx)("h5",{className:"text-sm font-semibold text-blue-900 uppercase tracking-wide mb-2",children:"Data Summary"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-xs",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-blue-600 font-medium",children:"Transcription"}),(0,s.jsxs)("div",{className:"text-blue-900",children:[l.transcription.length.toLocaleString()," chars"]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-blue-600 font-medium",children:"Account Fields"}),(0,s.jsxs)("div",{className:"text-blue-900",children:[Object.keys(l.salesforceContext).filter(e=>!["recent_tickets","account_id","linkedin_data"].includes(e)&&null!==l.salesforceContext[e]).length," provided"]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-blue-600 font-medium",children:"Support Cases"}),(0,s.jsxs)("div",{className:"text-blue-900",children:[l.salesforceContext.recent_tickets?.length||0," cases"]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-blue-600 font-medium",children:"LinkedIn Contacts"}),(0,s.jsxs)("div",{className:"text-blue-900",children:[l.salesforceContext.linkedin_data?.contacts.length||0," profiles"]})]})]})]})]}),o.length>0&&(0,s.jsxs)("div",{className:"bg-lean-white rounded-lg shadow-lg p-6 mb-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-lean-black mb-4",children:"Contact Level Breakdown"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[(0,s.jsxs)("div",{className:`rounded-lg p-4 border-2 ${L["C-Level"]>0?"bg-red-50 border-red-300":"bg-lean-almost-white border-lean-black/20"}`,children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("h4",{className:"font-semibold text-lean-black",children:"C-Level"}),L["C-Level"]>0&&(0,s.jsxs)("span",{className:"text-xs font-bold text-red-600 bg-red-100 px-2 py-1 rounded-full",children:["âš ï¸ ",L["C-Level"]," in cases"]})]}),(0,s.jsx)("div",{className:"text-2xl font-bold text-lean-black mb-1",children:S["C-Level"]}),(0,s.jsx)("div",{className:"text-xs text-lean-black-70",children:L["C-Level"]>0?(0,s.jsxs)("span",{className:"text-red-600 font-semibold",children:[L["C-Level"]," involved in support cases - Major concern"]}):(0,s.jsx)("span",{className:"text-lean-green",children:"No case involvement"})})]}),(0,s.jsxs)("div",{className:`rounded-lg p-4 border-2 ${L["Sr. Level"]>0?"bg-yellow-50 border-yellow-300":"bg-lean-almost-white border-lean-black/20"}`,children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("h4",{className:"font-semibold text-lean-black",children:"Sr. Level"}),L["Sr. Level"]>0&&(0,s.jsxs)("span",{className:"text-xs font-bold text-yellow-600 bg-yellow-100 px-2 py-1 rounded-full",children:["âš ï¸ ",L["Sr. Level"]," in cases"]})]}),(0,s.jsx)("div",{className:"text-2xl font-bold text-lean-black mb-1",children:S["Sr. Level"]}),(0,s.jsx)("div",{className:"text-xs text-lean-black-70",children:L["Sr. Level"]>0?(0,s.jsxs)("span",{className:"text-yellow-600 font-semibold",children:[L["Sr. Level"]," involved in support cases - Significant concern"]}):(0,s.jsx)("span",{className:"text-lean-green",children:"No case involvement"})})]}),(0,s.jsxs)("div",{className:"rounded-lg p-4 border-2 bg-lean-almost-white border-lean-black/20",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("h4",{className:"font-semibold text-lean-black",children:"Other"}),L.Other>0&&(0,s.jsxs)("span",{className:"text-xs text-lean-black-70",children:[L.Other," in cases"]})]}),(0,s.jsx)("div",{className:"text-2xl font-bold text-lean-black mb-1",children:S.Other}),(0,s.jsx)("div",{className:"text-xs text-lean-black-70",children:L.Other>0?(0,s.jsxs)("span",{children:[L.Other," involved in support cases"]}):(0,s.jsx)("span",{className:"text-lean-green",children:"No case involvement"})})]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[C["C-Level"].length>0&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("h4",{className:"text-sm font-semibold text-lean-black mb-2",children:["C-Level Contacts (",C["C-Level"].length,")"]}),(0,s.jsx)("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:C["C-Level"].map(e=>(0,s.jsxs)("div",{className:`text-sm p-2 rounded border ${e.involvedInCases?"bg-red-50 border-red-200":"bg-lean-almost-white border-lean-black/20"}`,children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"font-medium text-lean-black",children:e.name||`${e.firstName||""} ${e.lastName||""}`.trim()}),e.involvedInCases&&(0,s.jsx)("span",{className:"text-xs font-bold text-red-600 bg-red-100 px-2 py-0.5 rounded",children:"âš ï¸ In Cases"})]}),e.title&&(0,s.jsx)("p",{className:"text-xs text-lean-black-70 mt-1",children:e.title})]},e.id||e.email))})]}),C["Sr. Level"].length>0&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("h4",{className:"text-sm font-semibold text-lean-black mb-2",children:["Sr. Level Contacts (",C["Sr. Level"].length,")"]}),(0,s.jsx)("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:C["Sr. Level"].map(e=>(0,s.jsxs)("div",{className:`text-sm p-2 rounded border ${e.involvedInCases?"bg-yellow-50 border-yellow-200":"bg-lean-almost-white border-lean-black/20"}`,children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"font-medium text-lean-black",children:e.name||`${e.firstName||""} ${e.lastName||""}`.trim()}),e.involvedInCases&&(0,s.jsx)("span",{className:"text-xs font-bold text-yellow-600 bg-yellow-100 px-2 py-0.5 rounded",children:"âš ï¸ In Cases"})]}),e.title&&(0,s.jsx)("p",{className:"text-xs text-lean-black-70 mt-1",children:e.title})]},e.id||e.email))})]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[c.length>0&&(0,s.jsxs)("div",{className:"bg-lean-white rounded-lg shadow-lg p-6",children:[(0,s.jsxs)("h3",{className:"text-lg font-semibold text-lean-black mb-4",children:["Support Cases (",c.length,")"]}),(0,s.jsx)("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:c.map(e=>{let t=e.id?`https://leandata.my.salesforce.com/${e.id}`:null;return(0,s.jsxs)("div",{className:"bg-lean-almost-white rounded-lg p-3 border border-lean-black/20",children:[(0,s.jsxs)("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"font-medium text-blue-700 hover:text-blue-900 hover:underline flex items-center gap-1 mb-1",children:[e.caseNumber||e.id," - ",e.subject||"No Subject",(0,s.jsx)("svg",{className:"w-4 h-4 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})]}),(0,s.jsxs)("p",{className:"text-xs text-lean-black-70 mt-1",children:["Status: ",(0,s.jsx)("span",{className:`font-semibold ${"Closed"===e.status?"text-lean-green":"text-blue-600"}`,children:e.status}),(0,s.jsx)("span",{className:"mx-2",children:"|"})," Priority: ",(0,s.jsx)("span",{className:`font-semibold ${["High","Critical"].includes(e.priority)?"text-red-600":"text-lean-black-70"}`,children:e.priority||"N/A"})]}),(0,s.jsxs)("p",{className:"text-xs text-lean-black-60 mt-1",children:["Created: ",new Date(e.createdDate).toLocaleDateString()," ",e.closedDate?`| Closed: ${new Date(e.closedDate).toLocaleDateString()}`:""]})]},e.id)})})]}),o.length>0&&(0,s.jsxs)("div",{className:"bg-lean-white rounded-lg shadow-lg p-6",children:[(0,s.jsxs)("h3",{className:"text-lg font-semibold text-lean-black mb-4",children:["Account Contacts (",o.length,")"]}),(0,s.jsx)("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:_.map(e=>{e.contactLevel||(0,i.categorizeContactLevel)(e.title||e.linkedinProfile?.current_title||""),e.involvedInCases;let t=e.id?`https://leandata.my.salesforce.com/${e.id}`:null;return(0,s.jsxs)("div",{className:"bg-lean-almost-white rounded-lg p-3 border border-lean-black/20",children:[(0,s.jsxs)("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"font-medium text-blue-700 hover:text-blue-900 hover:underline flex items-center gap-1 mb-1",children:[e.name||`${e.firstName||""} ${e.lastName||""}`.trim()||"Contact",(0,s.jsx)("svg",{className:"w-4 h-4 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})]}),e.title&&(0,s.jsx)("p",{className:"text-xs text-lean-black-70 mt-1",children:e.title}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-x-3 gap-y-1 text-xs text-lean-black-60 mt-1",children:[e.email&&(0,s.jsx)("a",{href:`mailto:${e.email}`,className:"text-blue-600 hover:text-blue-800 hover:underline",children:e.email}),e.phone&&(0,s.jsx)("a",{href:`tel:${e.phone}`,className:"text-blue-600 hover:text-blue-800 hover:underline",children:e.phone}),e.linkedinURL&&(0,s.jsxs)("a",{href:e.linkedinURL,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 hover:underline flex items-center gap-1","aria-label":`View ${e.name} on LinkedIn`,children:[(0,s.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{d:"M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"})}),"LinkedIn"]})]}),e.linkedinProfile&&(0,s.jsxs)("div",{className:"mt-2 pt-2 border-t border-lean-black/20",children:[e.linkedinProfile.job_changed_recently&&(0,s.jsx)("p",{className:"text-xs text-red-600 font-semibold mb-1",children:"âš ï¸ Recent job change detected"}),e.linkedinProfile.current_title&&(0,s.jsxs)("p",{className:"text-xs text-lean-black-70",children:[(0,s.jsx)("span",{className:"font-medium",children:"LinkedIn:"})," ",e.linkedinProfile.current_title,e.linkedinProfile.current_company&&` at ${e.linkedinProfile.current_company}`]})]})]},e.id)})})]})]})]})}),(0,s.jsx)("footer",{className:"bg-lean-black px-4 sm:px-6 lg:px-8 py-4 flex-shrink-0",children:(0,s.jsx)("div",{className:"max-w-6xl mx-auto",children:(0,s.jsx)("p",{className:"text-xs text-[#f7f7f7] text-center",children:"âœ… Sentiment analysis is securely handled via Vercel Serverless Function"})})})]})},{sentiment:w,dataSources:R,analysisData:D,selectedAccount:u,cases:F,contacts:J,sentimentHistory:ei,historyLoading:ec,avomaWarning:eu,onBack:()=>{en(!1),_(null),E(null),T(null),er(null),eb(null)},onShowHelp:()=>ea(!0),onCloseHelp:()=>ea(!1),showHelp:et})}):(0,s.jsxs)("div",{className:"min-h-screen bg-lean-almost-white flex flex-col",children:[(0,s.jsx)(l.default,{user:e,onSignOut:d,showHelp:et,setShowHelp:ea}),(0,s.jsx)("main",{className:"flex-1 px-4 sm:px-6 lg:px-8 py-12",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto",children:[et&&(0,s.jsx)(ep,{onClose:()=>ea(!1)}),p?(0,s.jsx)("div",{className:"bg-lean-white rounded-lg shadow-lg p-6 mb-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,s.jsx)(n.LoaderIcon,{className:"w-6 h-6 animate-spin text-blue-600 mr-3"}),(0,s.jsx)("p",{className:"text-lean-black-70",children:"Loading your accounts..."})]})}):(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[(0,s.jsxs)("div",{className:"bg-lean-white rounded-lg shadow-lg p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("label",{htmlFor:"account-select",className:"block text-sm font-semibold text-lean-black",children:"ðŸ“‹ My Accounts"}),(0,s.jsx)("button",{onClick:()=>{m.push("/user")},className:"text-xs text-lean-green hover:text-lean-green/80 underline font-medium transition-colors","aria-label":"Manage accounts",children:"Manage Accounts â†’"})]}),x.length>0&&!$?(0,s.jsxs)("select",{id:"account-select",value:u?.id||"",onChange:e=>{let s=x.find(s=>s.id===e.target.value);b(s),f(s?.name||"")},className:"w-full px-4 py-3 border border-lean-black/20 rounded-lg focus:ring-2 focus:ring-lean-green focus:border-transparent outline-none transition-all","aria-label":"Select Salesforce account",children:[(0,s.jsx)("option",{value:"",children:"-- Select an account --"}),x.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.name," ",e.accountTier?`(${e.accountTier})`:""]},e.id))]}):$?(0,s.jsx)("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 rounded-lg",role:"alert",children:(0,s.jsx)("p",{className:"text-sm text-blue-700",children:"Currently showing search results. Select an account from the search results on the right."})}):(0,s.jsxs)("div",{className:"bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded-lg",role:"alert",children:[(0,s.jsxs)("p",{className:"text-sm text-yellow-700 mb-2",children:["No accounts found. Visit the ",(0,s.jsx)("strong",{children:"My Accounts"})," page to add accounts."]}),(0,s.jsx)("button",{onClick:()=>{m.push("/user")},className:"text-sm text-yellow-800 hover:text-yellow-900 underline font-semibold",children:"Go to My Accounts â†’"})]})]}),(0,s.jsxs)("div",{className:"bg-lean-white rounded-lg shadow-lg p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("label",{htmlFor:"account-search",className:"block text-sm font-semibold text-lean-black",children:$?"ðŸ” Search Results":"ðŸ” Search for Any Account"}),$&&(0,s.jsx)("button",{onClick:()=>{A(""),M(!1),b(null),f(""),y(null),window.location.reload()},className:"text-sm text-blue-600 hover:text-blue-800 underline","aria-label":"Clear search and show assigned accounts",children:"Show My Accounts"})]}),(0,s.jsxs)("div",{className:"flex gap-2 mb-4",children:[(0,s.jsx)("input",{id:"account-search",type:"text",value:L,onChange:e=>A(e.target.value),onKeyPress:e=>{"Enter"===e.key&&eN(L)},placeholder:"Type account name to search (min 2 characters)...",className:"flex-1 px-4 py-3 border-2 border-lean-black/20 rounded-lg focus:ring-2 focus:ring-lean-green focus:border-lean-green outline-none transition-all","aria-label":"Search for Salesforce account"}),(0,s.jsx)("button",{onClick:()=>eN(L),disabled:P||!L||L.trim().length<2,className:"px-6 py-3 bg-lean-green text-lean-white rounded-lg hover:bg-lean-green/90 disabled:bg-lean-black/30 disabled:cursor-not-allowed transition-colors font-medium shadow-md","aria-label":"Search accounts",children:P?(0,s.jsx)(n.LoaderIcon,{className:"w-5 h-5 animate-spin"}):"Search"})]}),$&&x.length>0?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("select",{id:"search-account-select",value:u?.id||"",onChange:e=>{let s=x.find(s=>s.id===e.target.value);b(s),f(s?.name||"")},className:"w-full px-4 py-3 border border-lean-black/20 rounded-lg focus:ring-2 focus:ring-lean-green focus:border-transparent outline-none transition-all","aria-label":"Select from search results",children:[(0,s.jsx)("option",{value:"",children:"-- Select from search results --"}),x.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.name," ",e.accountTier?`(${e.accountTier})`:""]},e.id))]}),(0,s.jsxs)("p",{className:"text-xs text-lean-black-60 mt-2",children:["Found ",x.length," account",1!==x.length?"s":"",". Select one to analyze."]})]}):$?(0,s.jsx)("div",{className:"bg-lean-almost-white border border-lean-black/20 rounded-lg p-4",children:(0,s.jsxs)("p",{className:"text-sm text-lean-black-70",children:['No accounts found matching "',L,'". Try a different search term.']})}):(0,s.jsx)("p",{className:"text-xs text-lean-black-60",children:"Search for any account in Salesforce by name. Results will appear here."})]})]}),u&&(0,s.jsxs)("div",{className:"bg-lean-white rounded-lg shadow-lg p-6 mb-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h3",{className:"text-sm font-semibold text-lean-black",children:"Selected Account Details"}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[ex?(0,s.jsxs)("div",{className:"flex items-center gap-2 text-xs text-lean-black-70",children:[(0,s.jsx)(n.LoaderIcon,{className:"w-4 h-4 animate-spin text-lean-green"}),(0,s.jsx)("span",{children:"Checking cache..."})]}):ed?(0,s.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:[(0,s.jsx)("span",{className:"px-2 py-1 bg-green-100 text-green-800 rounded-full font-medium",children:"âœ“ Cached"}),(0,s.jsx)("span",{className:"text-lean-black-70",children:(()=>{try{let e=new Date(ed.analyzed_at),s=new Date-e,t=Math.floor(s/864e5),a=Math.floor(s/36e5);if(0===t&&0===a){let e=Math.floor(s/6e4);return e<1?"Just now":`${e} min ago`}if(0===t)return`${a} hour${1!==a?"s":""} ago`;if(1===t)return"Yesterday";else if(t<7)return`${t} days ago`;else return e.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}catch{return"Recently"}})()})]}):null,ed?(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{onClick:()=>{ed.id?m.push(`/sentiment/${ed.id}`):(_({score:ed.score,summary:ed.summary,comprehensiveAnalysis:ed.comprehensive_analysis||ed.summary,cached:!0,analyzedAt:ed.analyzed_at}),en(!0))},disabled:v,className:"px-4 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-all text-sm","aria-label":"View cached sentiment",children:"View Cached"}),(0,s.jsx)("button",{onClick:()=>ek(0,!0),disabled:v||!u||!j,className:"px-4 py-2 bg-lean-green text-lean-white font-semibold rounded-lg hover:bg-lean-green/90 focus:outline-none focus:ring-2 focus:ring-lean-green focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center gap-2 text-sm","aria-label":v?"Re-running analysis":"Re-run analysis","aria-busy":v,children:v?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.LoaderIcon,{className:"w-4 h-4 animate-spin"}),(0,s.jsx)("span",{children:"Analyzing..."})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),(0,s.jsx)("span",{children:"Re-run"})]})})]}):(0,s.jsx)("button",{onClick:()=>ek(0,!1),disabled:v||!u||!j,className:"px-6 py-2 bg-lean-green text-lean-white font-semibold rounded-lg hover:bg-lean-green/90 focus:outline-none focus:ring-2 focus:ring-lean-green focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center gap-2","aria-label":v?"Analyzing sentiment":"View sentiment analysis","aria-busy":v,children:v?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.LoaderIcon,{className:"w-5 h-5 animate-spin"}),(0,s.jsx)("span",{children:"Analyzing..."})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),(0,s.jsx)("span",{children:"View Sentiment"})]})})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-lean-black-70",children:"Account:"}),(0,s.jsx)("span",{className:"ml-2 font-medium text-lean-black block",children:u.name})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-lean-black-70",children:"Tier:"}),(0,s.jsx)("span",{className:"ml-2 font-medium text-lean-black",children:u.accountTier||"N/A"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-lean-black-70",children:"Contract Value:"}),(0,s.jsx)("span",{className:"ml-2 font-medium text-lean-black",children:(0,i.formatCurrency)(u.contractValue)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-lean-black-70",children:"Industry:"}),(0,s.jsx)("span",{className:"ml-2 font-medium text-lean-black",children:u.industry||"N/A"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-lean-black-70",children:"Owner:"}),(0,s.jsx)("span",{className:"ml-2 font-medium text-lean-black",children:u.ownerName||"N/A"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-lean-black-70",children:"Support Cases:"}),(0,s.jsx)("span",{className:"ml-2 font-medium text-lean-black",children:B?(0,s.jsx)("span",{className:V?"text-blue-600":"text-orange-600",children:V?"Loading from cache...":"Loading from Salesforce..."}):F.length>0?(0,s.jsxs)("button",{onClick:()=>q(!G),className:"text-blue-600 hover:text-blue-800 underline font-semibold","aria-label":`${F.length} cases - click to ${G?"hide":"show"} list`,children:[F.length," case",1!==F.length?"s":""]}):"0"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-lean-black-70",children:"Contacts:"}),(0,s.jsx)("span",{className:"ml-2 font-medium text-lean-black",children:Y?(0,s.jsx)("span",{className:X?"text-blue-600":"text-orange-600",children:X?"Loading from cache...":"Loading from Salesforce..."}):J.length>0?(0,s.jsxs)("button",{onClick:()=>es(!ee),className:"text-blue-600 hover:text-blue-800 underline font-semibold","aria-label":`${J.length} contacts - click to ${ee?"hide":"show"} list`,children:[J.length," contact",1!==J.length?"s":""]}):"0"})]})]}),F.length>0&&G&&(0,s.jsxs)("div",{className:"mt-4 pt-4 border-t border-lean-black/20",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsxs)("h4",{className:"text-sm font-semibold text-lean-black",children:["Recent Support Cases (",F.length,")"]}),(0,s.jsx)("button",{onClick:()=>q(!1),className:"text-xs text-lean-black-60 hover:text-lean-black-80","aria-label":"Hide cases list",children:"Hide"})]}),(0,s.jsx)("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:F.map((e,t)=>{let a=e.id?`https://leandata.my.salesforce.com/${e.id}`:null;return(0,s.jsx)("div",{className:"bg-lean-almost-white rounded-lg p-3 border border-lean-black/20 hover:border-lean-green/30 hover:bg-lean-green-10 transition-colors",children:(0,s.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[a?(0,s.jsx)("a",{href:a,target:"_blank",rel:"noopener noreferrer",className:"font-semibold text-blue-600 hover:text-blue-800 hover:underline text-sm",onClick:e=>e.stopPropagation(),children:e.caseNumber||`Case ${t+1}`}):(0,s.jsx)("span",{className:"font-semibold text-lean-black text-sm",children:e.caseNumber||`Case ${t+1}`}),(0,s.jsx)("span",{className:`text-xs px-2 py-0.5 rounded-full ${"Closed"===e.status?"bg-green-100 text-green-800":"Open"===e.status?"bg-blue-100 text-blue-800":"High"===e.priority||"Critical"===e.priority?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:e.status||"Unknown"}),e.priority&&(0,s.jsxs)("span",{className:"text-xs text-lean-black-70",children:[e.priority," priority"]})]}),(0,s.jsx)("p",{className:"text-sm text-lean-black font-medium mb-1",children:e.subject||"No subject"}),e.createdDate&&(0,s.jsxs)("p",{className:"text-xs text-lean-black-60",children:["Created: ",new Date(e.createdDate).toLocaleDateString(),e.closedDate&&(0,s.jsxs)("span",{className:"ml-2",children:["â€¢ Closed: ",new Date(e.closedDate).toLocaleDateString()]})]})]}),a&&(0,s.jsx)("a",{href:a,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 flex-shrink-0",onClick:e=>e.stopPropagation(),"aria-label":`Open case ${e.caseNumber} in Salesforce`,children:(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})})]})},t)})})]}),J.length>0&&ee&&(0,s.jsxs)("div",{className:"mt-4 pt-4 border-t border-lean-black/20",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsxs)("h4",{className:"text-sm font-semibold text-lean-black",children:["Account Contacts (",J.length,")"]}),(0,s.jsx)("button",{onClick:()=>es(!1),className:"text-xs text-lean-black-60 hover:text-lean-black-80","aria-label":"Hide contacts list",children:"Hide"})]}),(0,s.jsx)("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:J.map((e,t)=>{let a,l,n=e.id?`https://leandata.my.salesforce.com/${e.id}`:null;return(0,s.jsx)("div",{className:"bg-lean-almost-white rounded-lg p-3 border border-lean-black/20 hover:border-lean-green/30 hover:bg-lean-green-10 transition-colors",children:(0,s.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[n?(0,s.jsx)("a",{href:n,target:"_blank",rel:"noopener noreferrer",className:"font-semibold text-blue-600 hover:text-blue-800 hover:underline text-sm",onClick:e=>e.stopPropagation(),children:e.name||`${e.firstName||""} ${e.lastName||""}`.trim()||"Contact"}):(0,s.jsx)("span",{className:"font-semibold text-lean-black text-sm",children:e.name||`${e.firstName||""} ${e.lastName||""}`.trim()||"Contact"}),e.contactStatus&&(0,s.jsx)("span",{className:`text-xs px-2 py-0.5 rounded-full ${"Unqualified"===e.contactStatus?"bg-red-100 text-red-800":"bg-green-100 text-green-800"}`,children:e.contactStatus})]}),(0,s.jsxs)("div",{className:"text-xs text-lean-black-70 mb-1",children:[e.title&&(0,s.jsx)("span",{children:e.title}),e.department&&(0,s.jsxs)("span",{className:"ml-2 text-lean-black-60",children:["â€¢ ",e.department]}),e.reportsToName&&(0,s.jsxs)("span",{className:"ml-2 text-lean-black-60",children:["â€¢ Reports to: ",e.reportsToName]})]}),(e.linkedinProfile?.job_changed_recently||e.linkedinProfile?.job_change_likelihood&&e.linkedinProfile.job_change_likelihood>50)&&(0,s.jsxs)("div",{className:"mb-1",children:[(0,s.jsx)("span",{className:"text-xs px-2 py-0.5 rounded-full bg-yellow-100 text-yellow-800 font-semibold",children:"âš ï¸ Job Change Risk"}),e.linkedinProfile.days_in_current_role&&(0,s.jsxs)("span",{className:"text-xs text-lean-black-60 ml-2",children:["(",e.linkedinProfile.days_in_current_role," days in role)"]})]}),e.lastActivityDate&&(l=(a=Math.floor((new Date-new Date(e.lastActivityDate))/864e5))>90,(0,s.jsx)("div",{className:"mb-1",children:(0,s.jsxs)("span",{className:`text-xs ${l?"text-red-600 font-semibold":"text-lean-black-60"}`,children:["Last activity: ",a," days ago ",l?"(Stale)":""]})})),e.linkedinProfile&&(0,s.jsxs)("div",{className:"mb-1 flex flex-wrap gap-2",children:[e.linkedinProfile.email_verified&&(0,s.jsx)("span",{className:"text-xs px-2 py-0.5 rounded-full bg-green-100 text-green-800",children:"âœ“ Verified Email"}),e.linkedinProfile.company_industry&&(0,s.jsxs)("span",{className:"text-xs text-lean-black-60",children:["Industry: ",e.linkedinProfile.company_industry]}),e.linkedinProfile.company_size&&(0,s.jsxs)("span",{className:"text-xs text-lean-black-60",children:["Company: ",e.linkedinProfile.company_size.toLocaleString()," employees"]})]}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-x-4 gap-y-1 text-xs text-lean-black-60",children:[e.email&&(0,s.jsx)("a",{href:`mailto:${e.email}`,className:"text-blue-600 hover:text-blue-800 hover:underline",children:e.email}),e.phone&&(0,s.jsx)("a",{href:`tel:${e.phone}`,className:"text-blue-600 hover:text-blue-800 hover:underline",children:e.phone}),e.mobilePhone&&!e.phone&&(0,s.jsxs)("a",{href:`tel:${e.mobilePhone}`,className:"text-blue-600 hover:text-blue-800 hover:underline",children:[e.mobilePhone," (mobile)"]}),e.mailingCity&&e.mailingState&&(0,s.jsxs)("span",{className:"text-lean-black-60",children:["ðŸ“ ",e.mailingCity,", ",e.mailingState]})]})]}),n&&(0,s.jsx)("a",{href:n,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 flex-shrink-0",onClick:e=>e.stopPropagation(),"aria-label":`Open contact ${e.name} in Salesforce`,children:(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})})]})},t)})})]})]}),k&&(0,s.jsx)("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 rounded-lg mb-6",role:"alert","aria-live":"polite",children:(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)("div",{className:"flex-shrink-0","aria-hidden":"true",children:(0,s.jsx)("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),(0,s.jsxs)("div",{className:"ml-3 flex-1",children:[(0,s.jsx)("p",{className:"text-sm text-red-700 font-medium",children:"Error"}),(0,s.jsx)("p",{className:"text-sm text-red-600 mt-1",children:k}),C>0&&C<3&&(0,s.jsx)("div",{className:"mt-3",children:(0,s.jsxs)("button",{onClick:()=>ek(C),className:"text-sm text-red-700 hover:text-red-900 font-medium underline","aria-label":`Retry analysis (attempt ${C+1} of 3)`,children:["Retry (",C,"/",3,")"]})})]})]})}),!1]})}),(0,s.jsx)("footer",{className:"bg-lean-black px-4 sm:px-6 lg:px-8 py-4 flex-shrink-0",children:(0,s.jsx)("div",{className:"max-w-6xl mx-auto",children:(0,s.jsx)("p",{className:"text-xs text-[#f7f7f7] text-center",children:"âœ… Sentiment analysis is securely handled via Vercel Serverless Function"})})})]})}])},95233,e=>{e.n(e.i(80080))}]);