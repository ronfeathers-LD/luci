module.exports=[83277,e=>{"use strict";var r=e.i(47909),t=e.i(74017),a=e.i(96250),n=e.i(59756),o=e.i(61916),s=e.i(14444),c=e.i(37092),l=e.i(69741),i=e.i(16795),u=e.i(87718),d=e.i(95169),E=e.i(47587),m=e.i(66012),f=e.i(70101),g=e.i(26937),h=e.i(10372),p=e.i(93695);e.i(52474);var R=e.i(220),y=e.i(89171),_=e.i(69122),w=e.i(3030);let{authenticateSalesforce:I,escapeSOQL:T}=e.r(77182),{isCacheFresh:A}=e.r(30273),{MAX_REQUEST_SIZE:v,CACHE_TTL:O,API_LIMITS:C}=e.r(982);async function N(e,r,t,a,n=!1){let o=null;try{let r=T(t),a=`SELECT Id FROM User WHERE Email = '${r}' LIMIT 1`,n=await e.query(a);n.records&&n.records.length>0?(o=n.records[0].Id,(0,w.log)(`Found Salesforce User ID: ${o} for email: ${t}`)):(0,w.logWarn)(`No Salesforce User found for email: ${t}`)}catch(e){(0,w.logWarn)(`Could not find Salesforce User for email ${t}:`,e.message)}let s="Id, Name, Employee_Band__c, Expiring_Revenue__c, Type, Industry, AnnualRevenue, OwnerId, Owner.Name, Owner.Email",c="Id, Name, Type, Industry, AnnualRevenue, OwnerId, Owner.Name, Owner.Email",l=!0,i=[],u=new Map;if(n||"Account Manager"===a||"Sales Rep"===a){try{let r=T(t),a=`SELECT ${s} FROM Account WHERE Owner.Email = '${r}' AND Type != 'Former Customer' ORDER BY Name LIMIT 100`;try{let r=await e.query(a);r.records&&(r.records.forEach(e=>{u.set(e.Id,e)}),(0,w.log)(`Found ${r.records.length} accounts owned by ${t}`))}catch(n){if("INVALID_FIELD"===n.errorCode)if((0,w.logWarn)("INVALID_FIELD error in Salesforce query",{errorCode:n.errorCode}),n.message&&n.message.includes("Type")){(0,w.logWarn)("Type field issue on Account, querying without Type filter");try{a=`SELECT ${s} FROM Account WHERE Owner.Email = '${r}' ORDER BY Name LIMIT 100`;let n=await e.query(a);n.records&&(n.records.forEach(e=>{u.set(e.Id,e)}),(0,w.log)(`Found ${n.records.length} accounts owned by ${t} (without Type filter)`))}catch(n){if("INVALID_FIELD"===n.errorCode){(0,w.logWarn)("Custom fields not found, trying alternative field names...");try{a=`SELECT Id, Name, Employee_Band__c, Expiring_Revenue__c, Tier__c, ContractValue__c, Industry, AnnualRevenue, OwnerId, Owner.Name, Owner.Email FROM Account WHERE Owner.Email = '${r}' ORDER BY Name LIMIT 100`;let t=await e.query(a);t.records&&(t.records.forEach(e=>{u.set(e.Id,e)}),(0,w.log)(`Found ${t.records.length} accounts with alternative field names`))}catch(o){(0,w.logWarn)("Alternative custom fields also not found, using standard fields only"),l=!1,a=`SELECT ${c} FROM Account WHERE Owner.Email = '${r}' ORDER BY Name LIMIT 100`;let n=await e.query(a);n.records&&(n.records.forEach(e=>{u.set(e.Id,e)}),(0,w.log)(`Found ${n.records.length} accounts owned by ${t} (standard fields only)`))}}else throw n}}else{(0,w.logWarn)("Custom fields not found, trying alternative field names...");let n="Id, Name, Employee_Band__c, Expiring_Revenue__c, Tier__c, ContractValue__c, Type, Industry, AnnualRevenue, OwnerId, Owner.Name, Owner.Email";try{a=`SELECT ${n} FROM Account WHERE Owner.Email = '${r}' AND Type != 'Former Customer' ORDER BY Name LIMIT 100`;let t=await e.query(a);t.records&&(t.records.forEach(e=>{u.set(e.Id,e)}),(0,w.log)(`Found ${t.records.length} accounts with alternative field names`))}catch(o){if("INVALID_FIELD"===o.errorCode&&o.message&&o.message.includes("Type")){(0,w.logWarn)("Type field not found, retrying without Type filter"),a=`SELECT ${n} FROM Account WHERE Owner.Email = '${r}' ORDER BY Name LIMIT 100`;let t=await e.query(a);t.records&&t.records.forEach(e=>{u.set(e.Id,e)})}else{(0,w.logWarn)("Alternative custom fields also not found, using standard fields only"),l=!1,a=`SELECT ${c} FROM Account WHERE Owner.Email = '${r}' AND Type != 'Former Customer' ORDER BY Name LIMIT 100`;try{let r=await e.query(a);r.records&&(r.records.forEach(e=>{u.set(e.Id,e)}),(0,w.log)(`Found ${r.records.length} accounts owned by ${t} (standard fields only)`))}catch(t){if("INVALID_FIELD"===t.errorCode&&t.message&&t.message.includes("Type")){a=`SELECT ${c} FROM Account WHERE Owner.Email = '${r}' ORDER BY Name LIMIT 100`;let t=await e.query(a);t.records&&t.records.forEach(e=>{u.set(e.Id,e)})}else throw t}}}}else throw n}}catch(e){(0,w.logError)("Error querying accounts by owner:",e)}if(!n&&o)try{let r=`SELECT AccountId FROM AccountTeamMember WHERE UserId = '${o}' LIMIT 100`,t=await e.query(r);if(t.records&&t.records.length>0){let r=t.records.map(e=>e.AccountId),a=l?s:c,n=r.map(e=>`'${T(e)}'`).join(","),o=`SELECT ${a} FROM Account WHERE Id IN (${n}) AND Type != 'Former Customer' ORDER BY Name`;try{let r=await e.query(o);r.records&&(r.records.forEach(e=>{u.set(e.Id,e)}),(0,w.log)(`Found ${r.records.length} accounts from AccountTeamMember`))}catch(r){if("INVALID_FIELD"===r.errorCode&&l){let r=`SELECT ${c} FROM Account WHERE Id IN (${n}) AND Type != 'Former Customer' ORDER BY Name`,t=await e.query(r);t.records&&(t.records.forEach(e=>{u.set(e.Id,e)}),(0,w.log)(`Found ${t.records.length} accounts from AccountTeamMember (standard fields)`))}else(0,w.logError)("Error querying accounts from AccountTeamMember:",r)}}}catch(e){(0,w.logError)("Error querying AccountTeamMember:",e)}i=Array.from(u.values())}else try{let r=`SELECT ${s} FROM Account WHERE Type != 'Former Customer' ORDER BY Name LIMIT 100`;try{i=(await e.query(r)).records||[]}catch(t){if("INVALID_FIELD"===t.errorCode)(0,w.logWarn)("Custom fields not found, using standard fields only"),r=`SELECT ${c} FROM Account WHERE Type != 'Former Customer' ORDER BY Name LIMIT 100`,i=(await e.query(r)).records||[];else throw t}}catch(e){throw(0,w.logError)("Error querying all accounts:",e),e}return i}async function S(e,r){if(!e||!r||r.trim().length<2)return null;let t=r.trim(),{data:a,error:n}=await e.from("accounts").select("*").ilike("name",`%${t}%`).order("name",{ascending:!0}).limit(20);if(n||!a||0===a.length)return null;let o=new Date,s=60*O.ACCOUNTS*6e4,c=a.every(e=>!!e.last_synced_at&&o-new Date(e.last_synced_at)<s);return{accounts:a,isFresh:c}}async function $(e,r){if(!r||r.trim().length<2)return[];let t=T(r.trim()),a="Id, Name, Employee_Band__c, Expiring_Revenue__c, Type, Industry, AnnualRevenue, OwnerId, Owner.Name, Owner.Email",n="Id, Name, Type, Industry, AnnualRevenue, OwnerId, Owner.Name, Owner.Email",o=`SELECT ${a} FROM Account WHERE Name LIKE '%${t}%' AND Type != 'Former Customer' ORDER BY Name LIMIT 20`;try{return(await e.query(o)).records||[]}catch(r){if("INVALID_FIELD"===r.errorCode){if(r.message&&r.message.includes("Type")){(0,w.logWarn)("Type field issue on Account, searching without Type filter");try{return o=`SELECT ${a} FROM Account WHERE Name LIKE '%${t}%' ORDER BY Name LIMIT 20`,(await e.query(o)).records||[]}catch(r){if("INVALID_FIELD"===r.errorCode)return o=`SELECT ${n} FROM Account WHERE Name LIKE '%${t}%' ORDER BY Name LIMIT 20`,(await e.query(o)).records||[];throw r}}try{return o=`SELECT ${n} FROM Account WHERE Name LIKE '%${t}%' AND Type != 'Former Customer' ORDER BY Name LIMIT 20`,(await e.query(o)).records||[]}catch(r){if("INVALID_FIELD"===r.errorCode&&r.message&&r.message.includes("Type"))return o=`SELECT ${n} FROM Account WHERE Name LIKE '%${t}%' ORDER BY Name LIMIT 20`,(await e.query(o)).records||[];throw r}}throw(0,w.logError)("Error searching accounts:",r),r}}async function L(e,r,t=null,a=!0){if(!e||!r||0===r.length)return[];let n=[];for(let o of r){let r=o.Employee_Band__c||o.Account_Segment__c||o.Account_Tier__c||o.Tier__c||o.AccountTier__c||o.Tier||null,s=o.Expiring_Revenue__c||o.Expiring_ARR__c||o.ExpiringARR__c||o.ARR_Expiring__c||o.Contract_Value__c||o.ContractValue__c||o.Contract_Value||o.ContractValue||null,c={salesforce_id:o.Id,name:o.Name,account_tier:r,contract_value:s,industry:o.Industry||null,annual_revenue:o.AnnualRevenue||null,owner_id:o.OwnerId||null,owner_name:o.Owner?.Name||null,last_synced_at:new Date().toISOString()},{data:l,error:i}=await e.from("accounts").upsert(c,{onConflict:"salesforce_id",ignoreDuplicates:!1}).select().single();if(i){(0,w.logError)(`Error syncing account ${o.Id}:`,i);continue}if(a&&t&&l){let{error:r}=await e.from("user_accounts").upsert({user_id:t,account_id:l.id},{onConflict:"user_id,account_id",ignoreDuplicates:!0});r&&(0,w.logError)("Error creating user-account relationship:",r)}n.push(l)}return n}async function D(e,r,t,a){let n;if(!e)return{accounts:null,needsRefresh:!0};if(r){let{data:t}=await e.from("users").select("*").eq("id",r).single();n=t}else if(t){let{data:r}=await e.from("users").select("*").eq("email",t).single();n=r}if(!n)return{accounts:null,needsRefresh:!0};let{data:o,error:s}=await e.from("user_accounts").select(`
      account_id,
      accounts (
        id,
        salesforce_id,
        name,
        account_tier,
        contract_value,
        industry,
        annual_revenue,
        owner_id,
        owner_name,
        last_synced_at
      )
    `).eq("user_id",n.id);if(s)return(0,w.logError)("Error fetching user_accounts:",s),{accounts:null,needsRefresh:!0};if(!o||0===o.length)return{accounts:null,needsRefresh:!0};let c=new Date,l=60*O.ACCOUNTS*6e4,i=!1;return{accounts:o.filter(e=>e.accounts).map(e=>{let r=e.accounts;if(!r)return null;let t=r.last_synced_at?new Date(r.last_synced_at):null;return(!t||c-t>l)&&(i=!0),{id:r.id,salesforceId:r.salesforce_id,name:r.name,accountTier:r.account_tier,contractValue:r.contract_value,industry:r.industry,annualRevenue:r.annual_revenue?parseFloat(r.annual_revenue):null,ownerId:r.owner_id,ownerName:r.owner_name,lastSyncedAt:r.last_synced_at}}).filter(e=>null!==e),needsRefresh:i}}async function F(){return(0,w.handlePreflight)(new y.NextRequest("http://localhost",{method:"OPTIONS"}))}async function M(e){let r=await (0,w.handlePreflight)(e);if(r)return r;let t=(0,w.validateRequestSize)(e,v.DEFAULT);if(!t.valid)return(0,w.sendErrorResponse)(Error(t.error.message),t.error.status);let{searchParams:a}=new URL(e.url),n=a.get("userId")?.trim()||null,o=a.get("email")?.trim()||null,s=a.get("role")?.trim()||null,c=a.get("forceRefresh"),l=a.get("search"),i=a.get("ownerOnly"),u=a.get("cacheOnly"),d=l&&l.trim().length>=2;if(!d&&!n&&!o)return(0,w.logError)("Missing required parameters",{userId:n,email:o,role:s,isSearch:d}),(0,w.sendErrorResponse)(Error("Missing required parameter: userId or email (or search term)"),400);let E="true"===c||"1"===c;try{let e,r=(0,_.getSupabaseClient)();if(!r)return(0,w.logError)("Supabase client is null - environment variables may not be set"),(0,w.sendErrorResponse)(Error("Database connection not configured. Please check environment variables (SUPABASE_URL, SUPABASE_SERVICE_ROLE_KEY)"),503);let t=(0,w.validateSupabase)(r);if(!t.valid)return(0,w.logError)(`Supabase validation failed: ${t.error.message}`),(0,w.sendErrorResponse)(Error(t.error.message),t.error.status);if(d)try{let e=await S(r,l);if(e&&e.isFresh){let r=e.accounts.map(e=>({id:e.id,salesforceId:e.salesforce_id,name:e.name,accountTier:e.account_tier,contractValue:e.contract_value,industry:e.industry,annualRevenue:e.annual_revenue?parseFloat(e.annual_revenue):null,ownerId:e.owner_id,ownerName:e.owner_name,lastSyncedAt:e.last_synced_at}));return(0,w.sendSuccessResponse)({accounts:r,total:r.length,searchTerm:l,isSearch:!0,cached:!0})}(0,w.log)(`No cache found for search: ${l}, querying Salesforce`);let t=await I(r),a=await $(t.connection,l),n=(await L(r,a,null,!1)).map(e=>({id:e.id,salesforceId:e.salesforce_id,name:e.name,accountTier:e.account_tier,contractValue:e.contract_value,industry:e.industry,annualRevenue:e.annual_revenue?parseFloat(e.annual_revenue):null,ownerId:e.owner_id,ownerName:e.owner_name,lastSyncedAt:e.last_synced_at}));return(0,w.sendSuccessResponse)({accounts:n,total:n.length,searchTerm:l,isSearch:!0,cached:!1})}catch(t){(0,w.logError)("Salesforce search error:",t);let e=await S(r,l);if(e&&e.accounts.length>0){let r=e.accounts.map(e=>({id:e.id,salesforceId:e.salesforce_id,name:e.name,accountTier:e.account_tier,contractValue:e.contract_value,industry:e.industry,annualRevenue:e.annual_revenue?parseFloat(e.annual_revenue):null,ownerId:e.owner_id,ownerName:e.owner_name,lastSyncedAt:e.last_synced_at}));return(0,w.sendSuccessResponse)({accounts:r,total:r.length,searchTerm:l,isSearch:!0,cached:!0,stale:!0})}return(0,w.sendErrorResponse)(t,500)}try{if(n&&n.trim()){let{data:t,error:a}=await r.from("users").select("*").eq("id",n).single();if(a)if("PGRST116"===a.code)o&&o.trim()?(0,w.logWarn)(`User not found by ID ${n}, trying email ${o}`):e=null;else throw(0,w.logError)("Error fetching user by ID:",a),a;else e=t}if(!e&&o&&o.trim()){let{data:t,error:a}=await r.from("users").select("*").eq("email",o).single();if(a)if("PGRST116"===a.code)(0,w.logError)(`User not found by email: ${o}`),e=null;else throw(0,w.logError)("Error fetching user by email:",a),a;else e=t}if(!e)return(0,w.logWarn)(`User not found in database - userId: ${n||"(empty)"}, email: ${o||"(empty)"}. Returning empty accounts.`),(0,w.sendSuccessResponse)({accounts:[],total:0,userId:null,role:s||"Account Manager",cached:!1,message:"User not found in database. Please log out and log back in to create your account."})}catch(e){return(0,w.logError)("Error in user lookup:",e),(0,w.sendErrorResponse)(e,500)}let a=[],c=!1,m=!0;if(!E)try{let t=await D(r,e.id,e.email,e.role);t&&t.accounts&&t.accounts.length>0&&(a=t.accounts,(m=t.needsRefresh||!1)||(c=!0))}catch(e){(0,w.logError)("Error getting cached accounts",e),a=[],m=!0}if("true"!==u&&"1"!==u&&(m||E)&&(E||0===a.length))try{let t=await I(r),n=await N(t.connection,e.id,e.email,e.role||s,"true"===i||"1"===i);(0,w.isProduction)()||(0,w.log)(`Syncing ${n.length} accounts to Supabase...`);let o=await L(r,n,e.id);(0,w.isProduction)()||(0,w.log)(`Synced ${o.length} accounts to Supabase`),a=o.map(e=>({id:e.salesforce_id||e.id,salesforceId:e.salesforce_id,name:e.name,accountTier:e.account_tier,contractValue:e.contract_value,industry:e.industry,annualRevenue:e.annual_revenue?parseFloat(e.annual_revenue):null,ownerId:e.owner_id,ownerName:e.owner_name,lastSyncedAt:e.last_synced_at})),c=!1}catch(r){if((0,w.logError)("Salesforce API error:",r),(0,w.logError)("Error details:",r.message),r.stack&&(0,w.logError)("Error stack:",r.stack),a.length>0)(0,w.logWarn)(`Salesforce query failed, using ${a.length} cached accounts (may be stale)`),c=!0;else{if("true"===u||"1"===u)return(0,w.log)("Cache-only mode: no cached accounts found, returning empty array"),(0,w.sendSuccessResponse)({accounts:[],total:0,userId:e.id,role:e.role||s||"Account Manager",cached:!1});return(0,w.logError)("No cached accounts available and Salesforce query failed"),(0,w.sendErrorResponse)(Error("Failed to fetch accounts from Salesforce and no cached accounts available"),500)}}else a.length>0&&(c=!0);return(0,w.sendSuccessResponse)({accounts:a,total:a.length,userId:e.id,role:e.role||s||"Account Manager",cached:c})}catch(r){console.error("[salesforce-accounts] Error caught:",{message:r.message,name:r.name,code:r.code,details:r.details,stack:r.stack}),(0,w.logError)("Error in salesforce-accounts function:",r),(0,w.logError)("Error message:",r.message),(0,w.logError)("Error name:",r.name),r.stack&&(0,w.logError)("Error stack:",r.stack),r.code&&(0,w.logError)("Error code:",r.code),r.details&&(0,w.logError)("Error details:",r.details);let e=r.message||"Internal server error";return(0,w.sendErrorResponse)(Error(`Failed to fetch accounts: ${e}`),500)}}e.s(["GET",()=>M,"OPTIONS",()=>F],4687);var b=e.i(4687);let q=new r.AppRouteRouteModule({definition:{kind:t.RouteKind.APP_ROUTE,page:"/api/salesforce-accounts/route",pathname:"/api/salesforce-accounts",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/salesforce-accounts/route.js",nextConfigOutput:"",userland:b}),{workAsyncStorage:x,workUnitAsyncStorage:H,serverHooks:P}=q;function W(){return(0,a.patchFetch)({workAsyncStorage:x,workUnitAsyncStorage:H})}async function U(e,r,a){q.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let y="/api/salesforce-accounts/route";y=y.replace(/\/index$/,"")||"/";let _=await q.prepare(e,r,{srcPage:y,multiZoneDraftMode:!1});if(!_)return r.statusCode=400,r.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:w,params:I,nextConfig:T,parsedUrl:A,isDraftMode:v,prerenderManifest:O,routerServerContext:C,isOnDemandRevalidate:N,revalidateOnlyGenerated:S,resolvedPathname:$,clientReferenceManifest:L,serverActionsManifest:D}=_,F=(0,l.normalizeAppPath)(y),M=!!(O.dynamicRoutes[F]||O.routes[$]),b=async()=>((null==C?void 0:C.render404)?await C.render404(e,r,A,!1):r.end("This page could not be found"),null);if(M&&!v){let e=!!O.routes[$],r=O.dynamicRoutes[F];if(r&&!1===r.fallback&&!e){if(T.experimental.adapterPath)return await b();throw new p.NoFallbackError}}let x=null;!M||q.isDev||v||(x="/index"===(x=$)?"/":x);let H=!0===q.isDev||!M,P=M&&!H;D&&L&&(0,s.setReferenceManifestsSingleton)({page:y,clientReferenceManifest:L,serverActionsManifest:D,serverModuleMap:(0,c.createServerModuleMap)({serverActionsManifest:D})});let W=e.method||"GET",U=(0,o.getTracer)(),B=U.getActiveScopeSpan(),k={params:I,prerenderManifest:O,renderOpts:{experimental:{authInterrupts:!!T.experimental.authInterrupts},cacheComponents:!!T.cacheComponents,supportsDynamicResponse:H,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:T.cacheLife,waitUntil:a.waitUntil,onClose:e=>{r.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(r,t,a)=>q.onRequestError(e,r,a,C)},sharedContext:{buildId:w}},V=new i.NodeNextRequest(e),Y=new i.NodeNextResponse(r),K=u.NextRequestAdapter.fromNodeNextRequest(V,(0,u.signalFromNodeResponse)(r));try{let s=async e=>q.handle(K,k).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":r.statusCode,"next.rsc":!1});let t=U.getRootSpanAttributes();if(!t)return;if(t.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${t.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=t.get("next.route");if(a){let r=`${W} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":r}),e.updateName(r)}else e.updateName(`${W} ${y}`)}),c=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var o,l;let i=async({previousCacheEntry:t})=>{try{if(!c&&N&&S&&!t)return r.statusCode=404,r.setHeader("x-nextjs-cache","REVALIDATED"),r.end("This page could not be found"),null;let o=await s(n);e.fetchMetrics=k.renderOpts.fetchMetrics;let l=k.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let i=k.renderOpts.collectedTags;if(!M)return await (0,m.sendResponse)(V,Y,o,k.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),r=(0,f.toNodeOutgoingHttpHeaders)(o.headers);i&&(r[h.NEXT_CACHE_TAGS_HEADER]=i),!r["content-type"]&&e.type&&(r["content-type"]=e.type);let t=void 0!==k.renderOpts.collectedRevalidate&&!(k.renderOpts.collectedRevalidate>=h.INFINITE_CACHE)&&k.renderOpts.collectedRevalidate,a=void 0===k.renderOpts.collectedExpire||k.renderOpts.collectedExpire>=h.INFINITE_CACHE?void 0:k.renderOpts.collectedExpire;return{value:{kind:R.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:r},cacheControl:{revalidate:t,expire:a}}}}catch(r){throw(null==t?void 0:t.isStale)&&await q.onRequestError(e,r,{routerKind:"App Router",routePath:y,routeType:"route",revalidateReason:(0,E.getRevalidateReason)({isStaticGeneration:P,isOnDemandRevalidate:N})},C),r}},u=await q.handleResponse({req:e,nextConfig:T,cacheKey:x,routeKind:t.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:O,isRoutePPREnabled:!1,isOnDemandRevalidate:N,revalidateOnlyGenerated:S,responseGenerator:i,waitUntil:a.waitUntil,isMinimalMode:c});if(!M)return null;if((null==u||null==(o=u.value)?void 0:o.kind)!==R.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(l=u.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});c||r.setHeader("x-nextjs-cache",N?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),v&&r.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let d=(0,f.fromNodeOutgoingHttpHeaders)(u.value.headers);return c&&M||d.delete(h.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||r.getHeader("Cache-Control")||d.get("Cache-Control")||d.set("Cache-Control",(0,g.getCacheControlHeader)(u.cacheControl)),await (0,m.sendResponse)(V,Y,new Response(u.value.body,{headers:d,status:u.value.status||200})),null};B?await l(B):await U.withPropagatedContext(e.headers,()=>U.trace(d.BaseServerSpan.handleRequest,{spanName:`${W} ${y}`,kind:o.SpanKind.SERVER,attributes:{"http.method":W,"http.target":e.url}},l))}catch(r){if(r instanceof p.NoFallbackError||await q.onRequestError(e,r,{routerKind:"App Router",routePath:F,routeType:"route",revalidateReason:(0,E.getRevalidateReason)({isStaticGeneration:P,isOnDemandRevalidate:N})}),M)throw r;return await (0,m.sendResponse)(V,Y,new Response(null,{status:500})),null}}e.s(["handler",()=>U,"patchFetch",()=>W,"routeModule",()=>q,"serverHooks",()=>P,"workAsyncStorage",()=>x,"workUnitAsyncStorage",()=>H],83277)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_7daf2fac.js.map