module.exports=[70406,(e,r,t)=>{r.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},18622,(e,r,t)=>{r.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,r,t)=>{r.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,r,t)=>{r.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,r,t)=>{r.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},93695,(e,r,t)=>{r.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},982,(e,r,t)=>{r.exports={MAX_REQUEST_SIZE:{DEFAULT:1048576,LARGE:0xa00000},REQUEST_TIMEOUT:3e4,RATE_LIMIT:{WINDOW:6e4,MAX_REQUESTS:10},CACHE_TTL:{ACCOUNTS:1,CASES:1,CONTACTS:24,TRANSCRIPTIONS:24,LINKEDIN_PROFILES:24,CALENDAR_EVENTS:15},API_LIMITS:{CASES_PER_ACCOUNT:25,CONTACTS_PER_ACCOUNT:100,ACCOUNTS_PER_USER:1e3}}},81944,(e,r,t)=>{let{MAX_REQUEST_SIZE:s,REQUEST_TIMEOUT:n}=e.r(982);function o(e,r=["GET","POST","OPTIONS"]){e.setHeader("Access-Control-Allow-Origin","*"),e.setHeader("Access-Control-Allow-Methods",r.join(", ")),e.setHeader("Access-Control-Allow-Headers","Content-Type, Authorization")}function a(e,r=!1){return r?{error:"An error occurred",message:"Please try again later or contact support if the problem persists."}:{error:e.message||"An error occurred",message:e.message,stack:e.stack}}function i(e,r,t=500,s=!1){o(e);let n=a(r,s);return e.status(t).json(n)}function l(){return!0}function u(e,r){let t=new Date().toISOString();return`[${t}] [${e.toUpperCase()}] ${r}`}let d=new Map,{RATE_LIMIT:c}=e.r(982);setInterval(()=>{let e=Date.now();for(let[r,t]of d.entries())e>t.resetTime&&d.delete(r)},c.WINDOW),r.exports={setCORSHeaders:o,handlePreflight:function(e,r){return"OPTIONS"===e.method&&(o(r),r.status(200).end())},validateRequestSize:function(e,r=s.DEFAULT){let t=e.headers["content-length"];return t&&parseInt(t)>r?{valid:!1,error:{status:413,message:"Request too large"}}:{valid:!0}},sanitizeError:a,sendErrorResponse:i,sendSuccessResponse:function(e,r,t=200){return o(e),e.status(t).json(r)},getClientIP:function(e){return e.headers["x-forwarded-for"]?.split(",")[0]||e.headers["x-real-ip"]||e.connection?.remoteAddress||"unknown"},validateSupabase:function(e,r){return!!e||(i(r,Error("Database not configured"),503,!0),!1)},checkRateLimit:function(e,r,t){let s=Date.now();if(!d.has(e))return d.set(e,{count:1,resetTime:s+r}),!0;let n=d.get(e);return s>n.resetTime?(n.count=1,n.resetTime=s+r,!0):!(n.count>=t)&&(n.count++,!0)},isProduction:l,log:function(e,r=null){},logError:function(e,r=null){r?console.error(u("error",e),r):console.error(u("error",e))},logWarn:function(e,r=null){},logDebug:function(e,r=null){}}},3030,e=>{"use strict";var r=e.i(89171);let t=e.r(81944),{MAX_REQUEST_SIZE:s,REQUEST_TIMEOUT:n,RATE_LIMIT:o}=e.r(982);function a(e,r=["GET","POST","OPTIONS"]){return e.headers.set("Access-Control-Allow-Origin","*"),e.headers.set("Access-Control-Allow-Methods",r.join(", ")),e.headers.set("Access-Control-Allow-Headers","Content-Type, Authorization"),e}async function i(e){return"OPTIONS"===e.method?a(new r.NextResponse(null,{status:200})):null}function l(e,r=s.DEFAULT){let t=e.headers.get("content-length");return t&&parseInt(t)>r?{valid:!1,error:{status:413,message:"Request too large"}}:{valid:!0}}function u(e,s=500){let n=t.isProduction(),o={error:n?"An error occurred":e?.message||"An error occurred",message:n?"Please try again later or contact support if the problem persists.":e?.message||"An error occurred"};return!n&&e?.stack&&(o.stack=e.stack),a(r.NextResponse.json(o,{status:s}))}function d(e,t=200){return a(r.NextResponse.json(e,{status:t}))}function c(e){let r=e.headers.get("x-forwarded-for");return r?r.split(",")[0].trim():e.headers.get("x-real-ip")||"unknown"}function p(e){return e?{valid:!0}:{valid:!1,error:{status:503,message:"Database not configured"}}}function g(e,r,s){return t.checkRateLimit(e,r,s)}let f=t.log,h=t.logError,R=t.logWarn;t.logDebug;let E=t.isProduction;e.s(["checkRateLimit",()=>g,"getClientIP",()=>c,"handlePreflight",()=>i,"isProduction",0,E,"log",0,f,"logError",0,h,"logWarn",0,R,"sendErrorResponse",()=>u,"sendSuccessResponse",()=>d,"validateRequestSize",()=>l,"validateSupabase",()=>p])},24186,e=>{"use strict";function r(e,r){console.error(`[ERROR] ${e}`,r)}async function t(e,t){let{data:s,error:n}=await e.from("user_roles").select(`
      role:roles!inner(id, name, description)
    `).eq("user_id",t);return n?(r("Error fetching user roles:",n),[]):(s||[]).map(e=>e.role)}async function s(e){let{data:t,error:s}=await e.from("users").select("id, email, name, picture, created_at").order("created_at",{ascending:!1});if(s)throw r("Error fetching users:",s),s;let{data:n,error:o}=await e.from("user_roles").select(`
      user_id,
      role:roles!inner(id, name, description)
    `);if(o)throw r("Error fetching user roles:",o),o;let a=(t||[]).map(e=>e.id),i={};if(a.length>0){let{data:r,error:t}=await e.from("user_logins").select("user_id, logged_in_at").in("user_id",a);!t&&r&&r.forEach(e=>{i[e.user_id]||(i[e.user_id]={last_login:e.logged_in_at,first_login:e.logged_in_at,login_count:0});let r=i[e.user_id];r.login_count++,new Date(e.logged_in_at)>new Date(r.last_login)&&(r.last_login=e.logged_in_at),new Date(e.logged_in_at)<new Date(r.first_login)&&(r.first_login=e.logged_in_at)})}let l={};return(n||[]).forEach(e=>{l[e.user_id]||(l[e.user_id]=[]),l[e.user_id].push(e.role)}),(t||[]).map(e=>({...e,roles:l[e.id]||[],login_stats:i[e.id]||{last_login:null,first_login:null,login_count:0}}))}e.s(["getAllUsersWithRoles",()=>s,"getUserRoles",()=>t])},84461,e=>{"use strict";var r=e.i(47909),t=e.i(74017),s=e.i(96250),n=e.i(59756),o=e.i(61916),a=e.i(14444),i=e.i(37092),l=e.i(69741),u=e.i(16795),d=e.i(87718),c=e.i(95169),p=e.i(47587),g=e.i(66012),f=e.i(70101),h=e.i(26937),R=e.i(10372),E=e.i(93695);e.i(52474);var m=e.i(220);e.i(89171);var w=e.i(69122),A=e.i(3030),_=e.i(24186);function x(e,r){console.error(`[ERROR] ${e}`,r)}async function v(){let e=new Response(null,{status:200});return e.headers.set("Access-Control-Allow-Origin","*"),e.headers.set("Access-Control-Allow-Methods","GET, PUT, OPTIONS"),e.headers.set("Access-Control-Allow-Headers","Content-Type, Authorization"),e}async function T(e){try{let r=(0,w.getSupabaseClient)(),t=(0,w.validateSupabase)(r);if(!t.valid)return(0,A.sendErrorResponse)(Error(t.error.message),t.error.status);let{searchParams:s}=new URL(e.url),n=s.get("userRoles"),o=s.get("userId");if("true"===n)if(o){let{data:e,error:t}=await r.from("users").select("id, email, name, picture, created_at").eq("id",o).single();if(t||!e)return(0,A.sendErrorResponse)(Error("User not found"),404);let s=await (0,_.getUserRoles)(r,o);return(0,A.sendSuccessResponse)({...e,roles:s})}else{let e=await (0,_.getAllUsersWithRoles)(r);return(0,A.sendSuccessResponse)({users:e})}{let{data:e,error:t}=await r.from("roles").select("*").order("name",{ascending:!0});if(t)throw x("Error fetching roles:",t),t;return(0,A.sendSuccessResponse)({roles:e||[]})}}catch(e){return x("Error in GET /api/roles:",e),(0,A.sendErrorResponse)(e,500)}}async function C(e){try{let{userId:r,roleIds:t,roleNames:s}=await e.json();if(!r)return(0,A.sendErrorResponse)(Error("Missing required field: userId"),400);let n=(0,w.getSupabaseClient)(),o=(0,w.validateSupabase)(n);if(!o.valid)return(0,A.sendErrorResponse)(Error(o.error.message),o.error.status);let{data:a,error:i}=await n.from("users").select("id").eq("id",r).single();if(i||!a)return(0,A.sendErrorResponse)(Error("User not found"),404);let l=await (0,_.getUserRoles)(n,r),u=new Set(l.map(e=>e.id)),d=[];if(t&&Array.isArray(t))d=t;else{if(!(s&&Array.isArray(s)))return(0,A.sendErrorResponse)(Error("Missing required field: roleIds or roleNames"),400);let{data:e,error:r}=await n.from("roles").select("id, name").in("name",s);if(r)return x("Error fetching roles:",r),(0,A.sendErrorResponse)(Error("Failed to fetch roles"),500);d=(e||[]).map(e=>e.id)}let c=new Set(d),p=d.filter(e=>!u.has(e)),g=Array.from(u).filter(e=>!c.has(e));if(g.length>0){let{error:e}=await n.from("user_roles").delete().eq("user_id",r).in("role_id",g);if(e)return x("Error removing user roles:",e),(0,A.sendErrorResponse)(Error("Failed to remove roles"),500)}if(p.length>0){let e=p.map(e=>({user_id:r,role_id:e})),{error:t}=await n.from("user_roles").insert(e);if(t)return x("Error adding user roles:",t),(0,A.sendErrorResponse)(Error("Failed to add roles"),500)}let f=await (0,_.getUserRoles)(n,r);return(0,A.sendSuccessResponse)({message:"User roles updated successfully",user:{id:r,roles:f}})}catch(e){return x("Error in PUT /api/roles:",e),(0,A.sendErrorResponse)(e,500)}}e.s(["GET",()=>T,"OPTIONS",()=>v,"PUT",()=>C],73634);var S=e.i(73634);let y=new r.AppRouteRouteModule({definition:{kind:t.RouteKind.APP_ROUTE,page:"/api/roles/route",pathname:"/api/roles",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/roles/route.js",nextConfigOutput:"",userland:S}),{workAsyncStorage:O,workUnitAsyncStorage:P,serverHooks:N}=y;function I(){return(0,s.patchFetch)({workAsyncStorage:O,workUnitAsyncStorage:P})}async function U(e,r,s){y.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let w="/api/roles/route";w=w.replace(/\/index$/,"")||"/";let A=await y.prepare(e,r,{srcPage:w,multiZoneDraftMode:!1});if(!A)return r.statusCode=400,r.end("Bad Request"),null==s.waitUntil||s.waitUntil.call(s,Promise.resolve()),null;let{buildId:_,params:x,nextConfig:v,parsedUrl:T,isDraftMode:C,prerenderManifest:S,routerServerContext:O,isOnDemandRevalidate:P,revalidateOnlyGenerated:N,resolvedPathname:I,clientReferenceManifest:U,serverActionsManifest:b}=A,k=(0,l.normalizeAppPath)(w),D=!!(S.dynamicRoutes[k]||S.routes[I]),q=async()=>((null==O?void 0:O.render404)?await O.render404(e,r,T,!1):r.end("This page could not be found"),null);if(D&&!C){let e=!!S.routes[I],r=S.dynamicRoutes[k];if(r&&!1===r.fallback&&!e){if(v.experimental.adapterPath)return await q();throw new E.NoFallbackError}}let M=null;!D||y.isDev||C||(M="/index"===(M=I)?"/":M);let j=!0===y.isDev||!D,H=D&&!j;b&&U&&(0,a.setReferenceManifestsSingleton)({page:w,clientReferenceManifest:U,serverActionsManifest:b,serverModuleMap:(0,i.createServerModuleMap)({serverActionsManifest:b})});let L=e.method||"GET",F=(0,o.getTracer)(),$=F.getActiveScopeSpan(),W={params:x,prerenderManifest:S,renderOpts:{experimental:{authInterrupts:!!v.experimental.authInterrupts},cacheComponents:!!v.cacheComponents,supportsDynamicResponse:j,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:v.cacheLife,waitUntil:s.waitUntil,onClose:e=>{r.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(r,t,s)=>y.onRequestError(e,r,s,O)},sharedContext:{buildId:_}},G=new u.NodeNextRequest(e),K=new u.NodeNextResponse(r),z=d.NextRequestAdapter.fromNodeNextRequest(G,(0,d.signalFromNodeResponse)(r));try{let a=async e=>y.handle(z,W).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":r.statusCode,"next.rsc":!1});let t=F.getRootSpanAttributes();if(!t)return;if(t.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${t.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let s=t.get("next.route");if(s){let r=`${L} ${s}`;e.setAttributes({"next.route":s,"http.route":s,"next.span_name":r}),e.updateName(r)}else e.updateName(`${L} ${w}`)}),i=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var o,l;let u=async({previousCacheEntry:t})=>{try{if(!i&&P&&N&&!t)return r.statusCode=404,r.setHeader("x-nextjs-cache","REVALIDATED"),r.end("This page could not be found"),null;let o=await a(n);e.fetchMetrics=W.renderOpts.fetchMetrics;let l=W.renderOpts.pendingWaitUntil;l&&s.waitUntil&&(s.waitUntil(l),l=void 0);let u=W.renderOpts.collectedTags;if(!D)return await (0,g.sendResponse)(G,K,o,W.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),r=(0,f.toNodeOutgoingHttpHeaders)(o.headers);u&&(r[R.NEXT_CACHE_TAGS_HEADER]=u),!r["content-type"]&&e.type&&(r["content-type"]=e.type);let t=void 0!==W.renderOpts.collectedRevalidate&&!(W.renderOpts.collectedRevalidate>=R.INFINITE_CACHE)&&W.renderOpts.collectedRevalidate,s=void 0===W.renderOpts.collectedExpire||W.renderOpts.collectedExpire>=R.INFINITE_CACHE?void 0:W.renderOpts.collectedExpire;return{value:{kind:m.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:r},cacheControl:{revalidate:t,expire:s}}}}catch(r){throw(null==t?void 0:t.isStale)&&await y.onRequestError(e,r,{routerKind:"App Router",routePath:w,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:P})},O),r}},d=await y.handleResponse({req:e,nextConfig:v,cacheKey:M,routeKind:t.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:S,isRoutePPREnabled:!1,isOnDemandRevalidate:P,revalidateOnlyGenerated:N,responseGenerator:u,waitUntil:s.waitUntil,isMinimalMode:i});if(!D)return null;if((null==d||null==(o=d.value)?void 0:o.kind)!==m.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(l=d.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||r.setHeader("x-nextjs-cache",P?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),C&&r.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,f.fromNodeOutgoingHttpHeaders)(d.value.headers);return i&&D||c.delete(R.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||r.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,h.getCacheControlHeader)(d.cacheControl)),await (0,g.sendResponse)(G,K,new Response(d.value.body,{headers:c,status:d.value.status||200})),null};$?await l($):await F.withPropagatedContext(e.headers,()=>F.trace(c.BaseServerSpan.handleRequest,{spanName:`${L} ${w}`,kind:o.SpanKind.SERVER,attributes:{"http.method":L,"http.target":e.url}},l))}catch(r){if(r instanceof E.NoFallbackError||await y.onRequestError(e,r,{routerKind:"App Router",routePath:k,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:P})}),D)throw r;return await (0,g.sendResponse)(G,K,new Response(null,{status:500})),null}}e.s(["handler",()=>U,"patchFetch",()=>I,"routeModule",()=>y,"serverHooks",()=>N,"workAsyncStorage",()=>O,"workUnitAsyncStorage",()=>P],84461)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__ffdc709d._.js.map